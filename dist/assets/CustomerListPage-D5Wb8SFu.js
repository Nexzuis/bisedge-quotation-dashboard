import{j as c,m as z,A as Qn}from"./vendor-motion-BTi7gxEc.js";import{r as u,R as k,f as Ne,u as dn,i as Zn}from"./vendor-react-CUuYCEpB.js";import{u as yt,a as es}from"./vendor-xlsx-Cig0qvpi.js";import{c as fn,av as ts,al as ut,am as oe,Z as hn,a0 as dt,u as jt,t as be,a2 as gn,m as ns,n as ss,k as rs,X as is,_ as ve,T as os,d as as,au as ls,a1 as cs,a as us,l as ds}from"./index-BQ8GchdQ.js";import{c as fs}from"./vendor-zustand-DbidXgKt.js";import{P as Pe,u as hs,U as Xt}from"./useActivities-DDyYIwR2.js";import{P as gs}from"./PipelineStageBadge-CYF83_GZ.js";import{A as ms}from"./arrow-right-DExnXAvI.js";import"./vendor-dexie-TCJlnc2g.js";import"./vendor-pdf-tjGXvEUX.js";import"./vendor-supabase-DxKkahmj.js";import"./trophy-C3NEYXtY.js";const ps=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],vs=fn("layout-grid",ps);const bs=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],xs=fn("list",bs),ae=fs()(ts(e=>({viewMode:"kanban",stageFilter:"all",stageFilters:[],searchQuery:"",setViewMode:n=>e({viewMode:n}),setStageFilter:n=>e({stageFilter:n}),setStageFilters:n=>e({stageFilters:n}),toggleStageFilter:n=>e(t=>{const s=t.stageFilters;return{stageFilters:s.includes(n)?s.filter(i=>i!==n):[...s,n]}}),setSearchQuery:n=>e({searchQuery:n})}),{name:"crm-ui-storage",partialize:e=>({viewMode:e.viewMode})}));function ys(){const e=ae(t=>t.viewMode),n=ae(t=>t.setViewMode);return c.jsxs("div",{className:"flex bg-surface-800/50 border border-surface-600 rounded-lg p-0.5 relative",children:[c.jsxs("button",{onClick:()=>n("kanban"),className:`relative flex items-center gap-1.5 px-3 py-1.5 rounded-md text-sm font-medium transition-colors z-10 ${e==="kanban"?"text-white":"text-surface-400 hover:text-surface-200"}`,children:[e==="kanban"&&c.jsx(z.div,{layoutId:"viewMode",className:"absolute inset-0 bg-brand-600 rounded-md",transition:{type:"spring",stiffness:400,damping:30}}),c.jsx(vs,{className:"w-4 h-4 relative z-10"}),c.jsx("span",{className:"relative z-10",children:"Kanban"})]}),c.jsxs("button",{onClick:()=>n("table"),className:`relative flex items-center gap-1.5 px-3 py-1.5 rounded-md text-sm font-medium transition-colors z-10 ${e==="table"?"text-white":"text-surface-400 hover:text-surface-200"}`,children:[e==="table"&&c.jsx(z.div,{layoutId:"viewMode",className:"absolute inset-0 bg-brand-600 rounded-md",transition:{type:"spring",stiffness:400,damping:30}}),c.jsx(xs,{className:"w-4 h-4 relative z-10"}),c.jsx("span",{className:"relative z-10",children:"Table"})]})]})}function ws(){const e=ae(o=>o.stageFilters),n=ae(o=>o.toggleStageFilter),t=ae(o=>o.setStageFilters),s=e.length===0,r=()=>{t([])},i=o=>{n(o)};return c.jsxs(z.div,{className:"flex flex-wrap gap-2 items-center",variants:ut,initial:"hidden",animate:"visible",role:"group","aria-label":"Filter by pipeline stage",children:[c.jsx(z.button,{variants:oe,onClick:r,"aria-pressed":s,className:`relative px-3 py-1 rounded-full text-xs font-medium transition-colors ${s?"bg-brand-600 text-white":"bg-surface-700/50 text-surface-400 hover:text-surface-200"}`,children:"All"}),Pe.map(o=>{const a=e.includes(o.key);return c.jsxs(z.label,{variants:oe,className:`relative flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium transition-colors cursor-pointer select-none ${a?`${o.bgColor} ${o.color}`:"bg-surface-700/50 text-surface-400 hover:text-surface-200"}`,children:[c.jsx("input",{type:"checkbox",className:"sr-only",checked:a,onChange:()=>i(o.key),"aria-label":`Filter by ${o.label}`}),c.jsx("span",{className:`inline-flex items-center justify-center w-3 h-3 rounded border transition-colors flex-shrink-0 ${a?`${o.bgColor} border-current`:"border-surface-500"}`,"aria-hidden":"true",children:a&&c.jsx("svg",{className:"w-2 h-2",viewBox:"0 0 8 8",fill:"none",children:c.jsx("path",{d:"M1.5 4L3 5.5L6.5 2",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),o.label]},o.key)})]})}function Ss(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return u.useMemo(()=>s=>{n.forEach(r=>r(s))},n)}const ft=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function je(e){const n=Object.prototype.toString.call(e);return n==="[object Window]"||n==="[object global]"}function Mt(e){return"nodeType"in e}function B(e){var n,t;return e?je(e)?e:Mt(e)&&(n=(t=e.ownerDocument)==null?void 0:t.defaultView)!=null?n:window:window}function At(e){const{Document:n}=B(e);return e instanceof n}function Ue(e){return je(e)?!1:e instanceof B(e).HTMLElement}function mn(e){return e instanceof B(e).SVGElement}function Me(e){return e?je(e)?e.document:Mt(e)?At(e)?e:Ue(e)||mn(e)?e.ownerDocument:document:document:document}const q=ft?u.useLayoutEffect:u.useEffect;function ht(e){const n=u.useRef(e);return q(()=>{n.current=e}),u.useCallback(function(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];return n.current==null?void 0:n.current(...s)},[])}function Cs(){const e=u.useRef(null),n=u.useCallback((s,r)=>{e.current=setInterval(s,r)},[]),t=u.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[n,t]}function We(e,n){n===void 0&&(n=[e]);const t=u.useRef(e);return q(()=>{t.current!==e&&(t.current=e)},n),t}function He(e,n){const t=u.useRef();return u.useMemo(()=>{const s=e(t.current);return t.current=s,s},[...n])}function rt(e){const n=ht(e),t=u.useRef(null),s=u.useCallback(r=>{r!==t.current&&n?.(r,t.current),t.current=r},[]);return[t,s]}function it(e){const n=u.useRef();return u.useEffect(()=>{n.current=e},[e]),n.current}let wt={};function Ke(e,n){return u.useMemo(()=>{if(n)return n;const t=wt[e]==null?0:wt[e]+1;return wt[e]=t,e+"-"+t},[e,n])}function pn(e){return function(n){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];return s.reduce((i,o)=>{const a=Object.entries(o);for(const[l,h]of a){const d=i[l];d!=null&&(i[l]=d+e*h)}return i},{...n})}}const Re=pn(1),ot=pn(-1);function Es(e){return"clientX"in e&&"clientY"in e}function gt(e){if(!e)return!1;const{KeyboardEvent:n}=B(e.target);return n&&e instanceof n}function Ds(e){if(!e)return!1;const{TouchEvent:n}=B(e.target);return n&&e instanceof n}function at(e){if(Ds(e)){if(e.touches&&e.touches.length){const{clientX:n,clientY:t}=e.touches[0];return{x:n,y:t}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:n,clientY:t}=e.changedTouches[0];return{x:n,y:t}}}return Es(e)?{x:e.clientX,y:e.clientY}:null}const me=Object.freeze({Translate:{toString(e){if(!e)return;const{x:n,y:t}=e;return"translate3d("+(n?Math.round(n):0)+"px, "+(t?Math.round(t):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:n,scaleY:t}=e;return"scaleX("+n+") scaleY("+t+")"}},Transform:{toString(e){if(e)return[me.Translate.toString(e),me.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:n,duration:t,easing:s}=e;return n+" "+t+"ms "+s}}}),Ut="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Ns(e){return e.matches(Ut)?e:e.querySelector(Ut)}const Rs={display:"none"};function js(e){let{id:n,value:t}=e;return k.createElement("div",{id:n,style:Rs},t)}function Ms(e){let{id:n,announcement:t,ariaLiveType:s="assertive"}=e;const r={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return k.createElement("div",{id:n,style:r,role:"status","aria-live":s,"aria-atomic":!0},t)}function As(){const[e,n]=u.useState("");return{announce:u.useCallback(s=>{s!=null&&n(s)},[]),announcement:e}}const vn=u.createContext(null);function Is(e){const n=u.useContext(vn);u.useEffect(()=>{if(!n)throw new Error("useDndMonitor must be used within a children of <DndContext>");return n(e)},[e,n])}function ks(){const[e]=u.useState(()=>new Set),n=u.useCallback(s=>(e.add(s),()=>e.delete(s)),[e]);return[u.useCallback(s=>{let{type:r,event:i}=s;e.forEach(o=>{var a;return(a=o[r])==null?void 0:a.call(o,i)})},[e]),n]}const Os={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Ts={onDragStart(e){let{active:n}=e;return"Picked up draggable item "+n.id+"."},onDragOver(e){let{active:n,over:t}=e;return t?"Draggable item "+n.id+" was moved over droppable area "+t.id+".":"Draggable item "+n.id+" is no longer over a droppable area."},onDragEnd(e){let{active:n,over:t}=e;return t?"Draggable item "+n.id+" was dropped over droppable area "+t.id:"Draggable item "+n.id+" was dropped."},onDragCancel(e){let{active:n}=e;return"Dragging was cancelled. Draggable item "+n.id+" was dropped."}};function zs(e){let{announcements:n=Ts,container:t,hiddenTextDescribedById:s,screenReaderInstructions:r=Os}=e;const{announce:i,announcement:o}=As(),a=Ke("DndLiveRegion"),[l,h]=u.useState(!1);if(u.useEffect(()=>{h(!0)},[]),Is(u.useMemo(()=>({onDragStart(f){let{active:g}=f;i(n.onDragStart({active:g}))},onDragMove(f){let{active:g,over:p}=f;n.onDragMove&&i(n.onDragMove({active:g,over:p}))},onDragOver(f){let{active:g,over:p}=f;i(n.onDragOver({active:g,over:p}))},onDragEnd(f){let{active:g,over:p}=f;i(n.onDragEnd({active:g,over:p}))},onDragCancel(f){let{active:g,over:p}=f;i(n.onDragCancel({active:g,over:p}))}}),[i,n])),!l)return null;const d=k.createElement(k.Fragment,null,k.createElement(js,{id:s,value:r.draggable}),k.createElement(Ms,{id:a,announcement:o}));return t?Ne.createPortal(d,t):d}var L;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(L||(L={}));function lt(){}function Ls(e,n){return u.useMemo(()=>({sensor:e,options:n??{}}),[e,n])}function Fs(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return u.useMemo(()=>[...n].filter(s=>s!=null),[...n])}const G=Object.freeze({x:0,y:0});function $s(e,n){const t=at(e);if(!t)return"0 0";const s={x:(t.x-n.left)/n.width*100,y:(t.y-n.top)/n.height*100};return s.x+"% "+s.y+"%"}function Ps(e,n){let{data:{value:t}}=e,{data:{value:s}}=n;return s-t}function Bs(e,n){if(!e||e.length===0)return null;const[t]=e;return t[n]}function Vs(e,n){const t=Math.max(n.top,e.top),s=Math.max(n.left,e.left),r=Math.min(n.left+n.width,e.left+e.width),i=Math.min(n.top+n.height,e.top+e.height),o=r-s,a=i-t;if(s<r&&t<i){const l=n.width*n.height,h=e.width*e.height,d=o*a,f=d/(l+h-d);return Number(f.toFixed(4))}return 0}const bn=e=>{let{collisionRect:n,droppableRects:t,droppableContainers:s}=e;const r=[];for(const i of s){const{id:o}=i,a=t.get(o);if(a){const l=Vs(a,n);l>0&&r.push({id:o,data:{droppableContainer:i,value:l}})}}return r.sort(Ps)};function _s(e,n,t){return{...e,scaleX:n&&t?n.width/t.width:1,scaleY:n&&t?n.height/t.height:1}}function xn(e,n){return e&&n?{x:e.left-n.left,y:e.top-n.top}:G}function Ws(e){return function(t){for(var s=arguments.length,r=new Array(s>1?s-1:0),i=1;i<s;i++)r[i-1]=arguments[i];return r.reduce((o,a)=>({...o,top:o.top+e*a.y,bottom:o.bottom+e*a.y,left:o.left+e*a.x,right:o.right+e*a.x}),{...t})}}const Xs=Ws(1);function yn(e){if(e.startsWith("matrix3d(")){const n=e.slice(9,-1).split(/, /);return{x:+n[12],y:+n[13],scaleX:+n[0],scaleY:+n[5]}}else if(e.startsWith("matrix(")){const n=e.slice(7,-1).split(/, /);return{x:+n[4],y:+n[5],scaleX:+n[0],scaleY:+n[3]}}return null}function Us(e,n,t){const s=yn(n);if(!s)return e;const{scaleX:r,scaleY:i,x:o,y:a}=s,l=e.left-o-(1-r)*parseFloat(t),h=e.top-a-(1-i)*parseFloat(t.slice(t.indexOf(" ")+1)),d=r?e.width/r:e.width,f=i?e.height/i:e.height;return{width:d,height:f,top:h,right:l+d,bottom:h+f,left:l}}const Hs={ignoreTransform:!1};function Ae(e,n){n===void 0&&(n=Hs);let t=e.getBoundingClientRect();if(n.ignoreTransform){const{transform:h,transformOrigin:d}=B(e).getComputedStyle(e);h&&(t=Us(t,h,d))}const{top:s,left:r,width:i,height:o,bottom:a,right:l}=t;return{top:s,left:r,width:i,height:o,bottom:a,right:l}}function Ht(e){return Ae(e,{ignoreTransform:!0})}function Ks(e){const n=e.innerWidth,t=e.innerHeight;return{top:0,left:0,right:n,bottom:t,width:n,height:t}}function Ys(e,n){return n===void 0&&(n=B(e).getComputedStyle(e)),n.position==="fixed"}function qs(e,n){n===void 0&&(n=B(e).getComputedStyle(e));const t=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(r=>{const i=n[r];return typeof i=="string"?t.test(i):!1})}function It(e,n){const t=[];function s(r){if(n!=null&&t.length>=n||!r)return t;if(At(r)&&r.scrollingElement!=null&&!t.includes(r.scrollingElement))return t.push(r.scrollingElement),t;if(!Ue(r)||mn(r)||t.includes(r))return t;const i=B(e).getComputedStyle(r);return r!==e&&qs(r,i)&&t.push(r),Ys(r,i)?t:s(r.parentNode)}return e?s(e):t}function wn(e){const[n]=It(e,1);return n??null}function St(e){return!ft||!e?null:je(e)?e:Mt(e)?At(e)||e===Me(e).scrollingElement?window:Ue(e)?e:null:null}function Sn(e){return je(e)?e.scrollX:e.scrollLeft}function Cn(e){return je(e)?e.scrollY:e.scrollTop}function Dt(e){return{x:Sn(e),y:Cn(e)}}var F;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(F||(F={}));function En(e){return!ft||!e?!1:e===document.scrollingElement}function Dn(e){const n={x:0,y:0},t=En(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},s={x:e.scrollWidth-t.width,y:e.scrollHeight-t.height},r=e.scrollTop<=n.y,i=e.scrollLeft<=n.x,o=e.scrollTop>=s.y,a=e.scrollLeft>=s.x;return{isTop:r,isLeft:i,isBottom:o,isRight:a,maxScroll:s,minScroll:n}}const Gs={x:.2,y:.2};function Js(e,n,t,s,r){let{top:i,left:o,right:a,bottom:l}=t;s===void 0&&(s=10),r===void 0&&(r=Gs);const{isTop:h,isBottom:d,isLeft:f,isRight:g}=Dn(e),p={x:0,y:0},w={x:0,y:0},m={height:n.height*r.y,width:n.width*r.x};return!h&&i<=n.top+m.height?(p.y=F.Backward,w.y=s*Math.abs((n.top+m.height-i)/m.height)):!d&&l>=n.bottom-m.height&&(p.y=F.Forward,w.y=s*Math.abs((n.bottom-m.height-l)/m.height)),!g&&a>=n.right-m.width?(p.x=F.Forward,w.x=s*Math.abs((n.right-m.width-a)/m.width)):!f&&o<=n.left+m.width&&(p.x=F.Backward,w.x=s*Math.abs((n.left+m.width-o)/m.width)),{direction:p,speed:w}}function Qs(e){if(e===document.scrollingElement){const{innerWidth:i,innerHeight:o}=window;return{top:0,left:0,right:i,bottom:o,width:i,height:o}}const{top:n,left:t,right:s,bottom:r}=e.getBoundingClientRect();return{top:n,left:t,right:s,bottom:r,width:e.clientWidth,height:e.clientHeight}}function Nn(e){return e.reduce((n,t)=>Re(n,Dt(t)),G)}function Zs(e){return e.reduce((n,t)=>n+Sn(t),0)}function er(e){return e.reduce((n,t)=>n+Cn(t),0)}function Rn(e,n){if(n===void 0&&(n=Ae),!e)return;const{top:t,left:s,bottom:r,right:i}=n(e);wn(e)&&(r<=0||i<=0||t>=window.innerHeight||s>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const tr=[["x",["left","right"],Zs],["y",["top","bottom"],er]];class kt{constructor(n,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const s=It(t),r=Nn(s);this.rect={...n},this.width=n.width,this.height=n.height;for(const[i,o,a]of tr)for(const l of o)Object.defineProperty(this,l,{get:()=>{const h=a(s),d=r[i]-h;return this.rect[l]+d},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Be{constructor(n){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(t=>{var s;return(s=this.target)==null?void 0:s.removeEventListener(...t)})},this.target=n}add(n,t,s){var r;(r=this.target)==null||r.addEventListener(n,t,s),this.listeners.push([n,t,s])}}function nr(e){const{EventTarget:n}=B(e);return e instanceof n?e:Me(e)}function Ct(e,n){const t=Math.abs(e.x),s=Math.abs(e.y);return typeof n=="number"?Math.sqrt(t**2+s**2)>n:"x"in n&&"y"in n?t>n.x&&s>n.y:"x"in n?t>n.x:"y"in n?s>n.y:!1}var Y;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(Y||(Y={}));function Kt(e){e.preventDefault()}function sr(e){e.stopPropagation()}var M;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(M||(M={}));const jn={start:[M.Space,M.Enter],cancel:[M.Esc],end:[M.Space,M.Enter,M.Tab]},rr=(e,n)=>{let{currentCoordinates:t}=n;switch(e.code){case M.Right:return{...t,x:t.x+25};case M.Left:return{...t,x:t.x-25};case M.Down:return{...t,y:t.y+25};case M.Up:return{...t,y:t.y-25}}};class Mn{constructor(n){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=n;const{event:{target:t}}=n;this.props=n,this.listeners=new Be(Me(t)),this.windowListeners=new Be(B(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Y.Resize,this.handleCancel),this.windowListeners.add(Y.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Y.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:n,onStart:t}=this.props,s=n.node.current;s&&Rn(s),t(G)}handleKeyDown(n){if(gt(n)){const{active:t,context:s,options:r}=this.props,{keyboardCodes:i=jn,coordinateGetter:o=rr,scrollBehavior:a="smooth"}=r,{code:l}=n;if(i.end.includes(l)){this.handleEnd(n);return}if(i.cancel.includes(l)){this.handleCancel(n);return}const{collisionRect:h}=s.current,d=h?{x:h.left,y:h.top}:G;this.referenceCoordinates||(this.referenceCoordinates=d);const f=o(n,{active:t,context:s.current,currentCoordinates:d});if(f){const g=ot(f,d),p={x:0,y:0},{scrollableAncestors:w}=s.current;for(const m of w){const v=n.code,{isTop:y,isRight:x,isLeft:C,isBottom:b,maxScroll:E,minScroll:D}=Dn(m),R=Qs(m),N={x:Math.min(v===M.Right?R.right-R.width/2:R.right,Math.max(v===M.Right?R.left:R.left+R.width/2,f.x)),y:Math.min(v===M.Down?R.bottom-R.height/2:R.bottom,Math.max(v===M.Down?R.top:R.top+R.height/2,f.y))},A=v===M.Right&&!x||v===M.Left&&!C,S=v===M.Down&&!b||v===M.Up&&!y;if(A&&N.x!==f.x){const j=m.scrollLeft+g.x,T=v===M.Right&&j<=E.x||v===M.Left&&j>=D.x;if(T&&!g.y){m.scrollTo({left:j,behavior:a});return}T?p.x=m.scrollLeft-j:p.x=v===M.Right?m.scrollLeft-E.x:m.scrollLeft-D.x,p.x&&m.scrollBy({left:-p.x,behavior:a});break}else if(S&&N.y!==f.y){const j=m.scrollTop+g.y,T=v===M.Down&&j<=E.y||v===M.Up&&j>=D.y;if(T&&!g.x){m.scrollTo({top:j,behavior:a});return}T?p.y=m.scrollTop-j:p.y=v===M.Down?m.scrollTop-E.y:m.scrollTop-D.y,p.y&&m.scrollBy({top:-p.y,behavior:a});break}}this.handleMove(n,Re(ot(f,this.referenceCoordinates),p))}}}handleMove(n,t){const{onMove:s}=this.props;n.preventDefault(),s(t)}handleEnd(n){const{onEnd:t}=this.props;n.preventDefault(),this.detach(),t()}handleCancel(n){const{onCancel:t}=this.props;n.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Mn.activators=[{eventName:"onKeyDown",handler:(e,n,t)=>{let{keyboardCodes:s=jn,onActivation:r}=n,{active:i}=t;const{code:o}=e.nativeEvent;if(s.start.includes(o)){const a=i.activatorNode.current;return a&&e.target!==a?!1:(e.preventDefault(),r?.({event:e.nativeEvent}),!0)}return!1}}];function Yt(e){return!!(e&&"distance"in e)}function qt(e){return!!(e&&"delay"in e)}class Ot{constructor(n,t,s){var r;s===void 0&&(s=nr(n.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=n,this.events=t;const{event:i}=n,{target:o}=i;this.props=n,this.events=t,this.document=Me(o),this.documentListeners=new Be(this.document),this.listeners=new Be(s),this.windowListeners=new Be(B(o)),this.initialCoordinates=(r=at(i))!=null?r:G,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:n,props:{options:{activationConstraint:t,bypassActivationConstraint:s}}}=this;if(this.listeners.add(n.move.name,this.handleMove,{passive:!1}),this.listeners.add(n.end.name,this.handleEnd),n.cancel&&this.listeners.add(n.cancel.name,this.handleCancel),this.windowListeners.add(Y.Resize,this.handleCancel),this.windowListeners.add(Y.DragStart,Kt),this.windowListeners.add(Y.VisibilityChange,this.handleCancel),this.windowListeners.add(Y.ContextMenu,Kt),this.documentListeners.add(Y.Keydown,this.handleKeydown),t){if(s!=null&&s({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(qt(t)){this.timeoutId=setTimeout(this.handleStart,t.delay),this.handlePending(t);return}if(Yt(t)){this.handlePending(t);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(n,t){const{active:s,onPending:r}=this.props;r(s,n,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:n}=this,{onStart:t}=this.props;n&&(this.activated=!0,this.documentListeners.add(Y.Click,sr,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Y.SelectionChange,this.removeTextSelection),t(n))}handleMove(n){var t;const{activated:s,initialCoordinates:r,props:i}=this,{onMove:o,options:{activationConstraint:a}}=i;if(!r)return;const l=(t=at(n))!=null?t:G,h=ot(r,l);if(!s&&a){if(Yt(a)){if(a.tolerance!=null&&Ct(h,a.tolerance))return this.handleCancel();if(Ct(h,a.distance))return this.handleStart()}if(qt(a)&&Ct(h,a.tolerance))return this.handleCancel();this.handlePending(a,h);return}n.cancelable&&n.preventDefault(),o(l)}handleEnd(){const{onAbort:n,onEnd:t}=this.props;this.detach(),this.activated||n(this.props.active),t()}handleCancel(){const{onAbort:n,onCancel:t}=this.props;this.detach(),this.activated||n(this.props.active),t()}handleKeydown(n){n.code===M.Esc&&this.handleCancel()}removeTextSelection(){var n;(n=this.document.getSelection())==null||n.removeAllRanges()}}const ir={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Tt extends Ot{constructor(n){const{event:t}=n,s=Me(t.target);super(n,ir,s)}}Tt.activators=[{eventName:"onPointerDown",handler:(e,n)=>{let{nativeEvent:t}=e,{onActivation:s}=n;return!t.isPrimary||t.button!==0?!1:(s?.({event:t}),!0)}}];const or={move:{name:"mousemove"},end:{name:"mouseup"}};var Nt;(function(e){e[e.RightClick=2]="RightClick"})(Nt||(Nt={}));class ar extends Ot{constructor(n){super(n,or,Me(n.event.target))}}ar.activators=[{eventName:"onMouseDown",handler:(e,n)=>{let{nativeEvent:t}=e,{onActivation:s}=n;return t.button===Nt.RightClick?!1:(s?.({event:t}),!0)}}];const Et={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class lr extends Ot{constructor(n){super(n,Et)}static setup(){return window.addEventListener(Et.move.name,n,{capture:!1,passive:!1}),function(){window.removeEventListener(Et.move.name,n)};function n(){}}}lr.activators=[{eventName:"onTouchStart",handler:(e,n)=>{let{nativeEvent:t}=e,{onActivation:s}=n;const{touches:r}=t;return r.length>1?!1:(s?.({event:t}),!0)}}];var Ve;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(Ve||(Ve={}));var ct;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(ct||(ct={}));function cr(e){let{acceleration:n,activator:t=Ve.Pointer,canScroll:s,draggingRect:r,enabled:i,interval:o=5,order:a=ct.TreeOrder,pointerCoordinates:l,scrollableAncestors:h,scrollableAncestorRects:d,delta:f,threshold:g}=e;const p=dr({delta:f,disabled:!i}),[w,m]=Cs(),v=u.useRef({x:0,y:0}),y=u.useRef({x:0,y:0}),x=u.useMemo(()=>{switch(t){case Ve.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case Ve.DraggableRect:return r}},[t,r,l]),C=u.useRef(null),b=u.useCallback(()=>{const D=C.current;if(!D)return;const R=v.current.x*y.current.x,N=v.current.y*y.current.y;D.scrollBy(R,N)},[]),E=u.useMemo(()=>a===ct.TreeOrder?[...h].reverse():h,[a,h]);u.useEffect(()=>{if(!i||!h.length||!x){m();return}for(const D of E){if(s?.(D)===!1)continue;const R=h.indexOf(D),N=d[R];if(!N)continue;const{direction:A,speed:S}=Js(D,N,x,n,g);for(const j of["x","y"])p[j][A[j]]||(S[j]=0,A[j]=0);if(S.x>0||S.y>0){m(),C.current=D,w(b,o),v.current=S,y.current=A;return}}v.current={x:0,y:0},y.current={x:0,y:0},m()},[n,b,s,m,i,o,JSON.stringify(x),JSON.stringify(p),w,h,E,d,JSON.stringify(g)])}const ur={x:{[F.Backward]:!1,[F.Forward]:!1},y:{[F.Backward]:!1,[F.Forward]:!1}};function dr(e){let{delta:n,disabled:t}=e;const s=it(n);return He(r=>{if(t||!s||!r)return ur;const i={x:Math.sign(n.x-s.x),y:Math.sign(n.y-s.y)};return{x:{[F.Backward]:r.x[F.Backward]||i.x===-1,[F.Forward]:r.x[F.Forward]||i.x===1},y:{[F.Backward]:r.y[F.Backward]||i.y===-1,[F.Forward]:r.y[F.Forward]||i.y===1}}},[t,n,s])}function fr(e,n){const t=n!=null?e.get(n):void 0,s=t?t.node.current:null;return He(r=>{var i;return n==null?null:(i=s??r)!=null?i:null},[s,n])}function hr(e,n){return u.useMemo(()=>e.reduce((t,s)=>{const{sensor:r}=s,i=r.activators.map(o=>({eventName:o.eventName,handler:n(o.handler,s)}));return[...t,...i]},[]),[e,n])}var Xe;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(Xe||(Xe={}));var Rt;(function(e){e.Optimized="optimized"})(Rt||(Rt={}));const Gt=new Map;function gr(e,n){let{dragging:t,dependencies:s,config:r}=n;const[i,o]=u.useState(null),{frequency:a,measure:l,strategy:h}=r,d=u.useRef(e),f=v(),g=We(f),p=u.useCallback(function(y){y===void 0&&(y=[]),!g.current&&o(x=>x===null?y:x.concat(y.filter(C=>!x.includes(C))))},[g]),w=u.useRef(null),m=He(y=>{if(f&&!t)return Gt;if(!y||y===Gt||d.current!==e||i!=null){const x=new Map;for(let C of e){if(!C)continue;if(i&&i.length>0&&!i.includes(C.id)&&C.rect.current){x.set(C.id,C.rect.current);continue}const b=C.node.current,E=b?new kt(l(b),b):null;C.rect.current=E,E&&x.set(C.id,E)}return x}return y},[e,i,t,f,l]);return u.useEffect(()=>{d.current=e},[e]),u.useEffect(()=>{f||p()},[t,f]),u.useEffect(()=>{i&&i.length>0&&o(null)},[JSON.stringify(i)]),u.useEffect(()=>{f||typeof a!="number"||w.current!==null||(w.current=setTimeout(()=>{p(),w.current=null},a))},[a,f,p,...s]),{droppableRects:m,measureDroppableContainers:p,measuringScheduled:i!=null};function v(){switch(h){case Xe.Always:return!1;case Xe.BeforeDragging:return t;default:return!t}}}function zt(e,n){return He(t=>e?t||(typeof n=="function"?n(e):e):null,[n,e])}function mr(e,n){return zt(e,n)}function pr(e){let{callback:n,disabled:t}=e;const s=ht(n),r=u.useMemo(()=>{if(t||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(s)},[s,t]);return u.useEffect(()=>()=>r?.disconnect(),[r]),r}function mt(e){let{callback:n,disabled:t}=e;const s=ht(n),r=u.useMemo(()=>{if(t||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(s)},[t]);return u.useEffect(()=>()=>r?.disconnect(),[r]),r}function vr(e){return new kt(Ae(e),e)}function Jt(e,n,t){n===void 0&&(n=vr);const[s,r]=u.useState(null);function i(){r(l=>{if(!e)return null;if(e.isConnected===!1){var h;return(h=l??t)!=null?h:null}const d=n(e);return JSON.stringify(l)===JSON.stringify(d)?l:d})}const o=pr({callback(l){if(e)for(const h of l){const{type:d,target:f}=h;if(d==="childList"&&f instanceof HTMLElement&&f.contains(e)){i();break}}}}),a=mt({callback:i});return q(()=>{i(),e?(a?.observe(e),o?.observe(document.body,{childList:!0,subtree:!0})):(a?.disconnect(),o?.disconnect())},[e]),s}function br(e){const n=zt(e);return xn(e,n)}const Qt=[];function xr(e){const n=u.useRef(e),t=He(s=>e?s&&s!==Qt&&e&&n.current&&e.parentNode===n.current.parentNode?s:It(e):Qt,[e]);return u.useEffect(()=>{n.current=e},[e]),t}function yr(e){const[n,t]=u.useState(null),s=u.useRef(e),r=u.useCallback(i=>{const o=St(i.target);o&&t(a=>a?(a.set(o,Dt(o)),new Map(a)):null)},[]);return u.useEffect(()=>{const i=s.current;if(e!==i){o(i);const a=e.map(l=>{const h=St(l);return h?(h.addEventListener("scroll",r,{passive:!0}),[h,Dt(h)]):null}).filter(l=>l!=null);t(a.length?new Map(a):null),s.current=e}return()=>{o(e),o(i)};function o(a){a.forEach(l=>{const h=St(l);h?.removeEventListener("scroll",r)})}},[r,e]),u.useMemo(()=>e.length?n?Array.from(n.values()).reduce((i,o)=>Re(i,o),G):Nn(e):G,[e,n])}function Zt(e,n){n===void 0&&(n=[]);const t=u.useRef(null);return u.useEffect(()=>{t.current=null},n),u.useEffect(()=>{const s=e!==G;s&&!t.current&&(t.current=e),!s&&t.current&&(t.current=null)},[e]),t.current?ot(e,t.current):G}function wr(e){u.useEffect(()=>{if(!ft)return;const n=e.map(t=>{let{sensor:s}=t;return s.setup==null?void 0:s.setup()});return()=>{for(const t of n)t?.()}},e.map(n=>{let{sensor:t}=n;return t}))}function Sr(e,n){return u.useMemo(()=>e.reduce((t,s)=>{let{eventName:r,handler:i}=s;return t[r]=o=>{i(o,n)},t},{}),[e,n])}function An(e){return u.useMemo(()=>e?Ks(e):null,[e])}const en=[];function Cr(e,n){n===void 0&&(n=Ae);const[t]=e,s=An(t?B(t):null),[r,i]=u.useState(en);function o(){i(()=>e.length?e.map(l=>En(l)?s:new kt(n(l),l)):en)}const a=mt({callback:o});return q(()=>{a?.disconnect(),o(),e.forEach(l=>a?.observe(l))},[e]),r}function In(e){if(!e)return null;if(e.children.length>1)return e;const n=e.children[0];return Ue(n)?n:e}function Er(e){let{measure:n}=e;const[t,s]=u.useState(null),r=u.useCallback(h=>{for(const{target:d}of h)if(Ue(d)){s(f=>{const g=n(d);return f?{...f,width:g.width,height:g.height}:g});break}},[n]),i=mt({callback:r}),o=u.useCallback(h=>{const d=In(h);i?.disconnect(),d&&i?.observe(d),s(d?n(d):null)},[n,i]),[a,l]=rt(o);return u.useMemo(()=>({nodeRef:a,rect:t,setRef:l}),[t,a,l])}const Dr=[{sensor:Tt,options:{}},{sensor:Mn,options:{}}],Nr={current:{}},st={draggable:{measure:Ht},droppable:{measure:Ht,strategy:Xe.WhileDragging,frequency:Rt.Optimized},dragOverlay:{measure:Ae}};class _e extends Map{get(n){var t;return n!=null&&(t=super.get(n))!=null?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(n=>{let{disabled:t}=n;return!t})}getNodeFor(n){var t,s;return(t=(s=this.get(n))==null?void 0:s.node.current)!=null?t:void 0}}const Rr={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new _e,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:lt},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:st,measureDroppableContainers:lt,windowRect:null,measuringScheduled:!1},kn={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:lt,draggableNodes:new Map,over:null,measureDroppableContainers:lt},Ye=u.createContext(kn),On=u.createContext(Rr);function jr(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new _e}}}function Mr(e,n){switch(n.type){case L.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:n.initialCoordinates,active:n.active}};case L.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:n.coordinates.x-e.draggable.initialCoordinates.x,y:n.coordinates.y-e.draggable.initialCoordinates.y}}};case L.DragEnd:case L.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case L.RegisterDroppable:{const{element:t}=n,{id:s}=t,r=new _e(e.droppable.containers);return r.set(s,t),{...e,droppable:{...e.droppable,containers:r}}}case L.SetDroppableDisabled:{const{id:t,key:s,disabled:r}=n,i=e.droppable.containers.get(t);if(!i||s!==i.key)return e;const o=new _e(e.droppable.containers);return o.set(t,{...i,disabled:r}),{...e,droppable:{...e.droppable,containers:o}}}case L.UnregisterDroppable:{const{id:t,key:s}=n,r=e.droppable.containers.get(t);if(!r||s!==r.key)return e;const i=new _e(e.droppable.containers);return i.delete(t),{...e,droppable:{...e.droppable,containers:i}}}default:return e}}function Ar(e){let{disabled:n}=e;const{active:t,activatorEvent:s,draggableNodes:r}=u.useContext(Ye),i=it(s),o=it(t?.id);return u.useEffect(()=>{if(!n&&!s&&i&&o!=null){if(!gt(i)||document.activeElement===i.target)return;const a=r.get(o);if(!a)return;const{activatorNode:l,node:h}=a;if(!l.current&&!h.current)return;requestAnimationFrame(()=>{for(const d of[l.current,h.current]){if(!d)continue;const f=Ns(d);if(f){f.focus();break}}})}},[s,n,r,o,i]),null}function Tn(e,n){let{transform:t,...s}=n;return e!=null&&e.length?e.reduce((r,i)=>i({transform:r,...s}),t):t}function Ir(e){return u.useMemo(()=>({draggable:{...st.draggable,...e?.draggable},droppable:{...st.droppable,...e?.droppable},dragOverlay:{...st.dragOverlay,...e?.dragOverlay}}),[e?.draggable,e?.droppable,e?.dragOverlay])}function kr(e){let{activeNode:n,measure:t,initialRect:s,config:r=!0}=e;const i=u.useRef(!1),{x:o,y:a}=typeof r=="boolean"?{x:r,y:r}:r;q(()=>{if(!o&&!a||!n){i.current=!1;return}if(i.current||!s)return;const h=n?.node.current;if(!h||h.isConnected===!1)return;const d=t(h),f=xn(d,s);if(o||(f.x=0),a||(f.y=0),i.current=!0,Math.abs(f.x)>0||Math.abs(f.y)>0){const g=wn(h);g&&g.scrollBy({top:f.y,left:f.x})}},[n,o,a,s,t])}const pt=u.createContext({...G,scaleX:1,scaleY:1});var ge;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(ge||(ge={}));const Or=u.memo(function(n){var t,s,r,i;let{id:o,accessibility:a,autoScroll:l=!0,children:h,sensors:d=Dr,collisionDetection:f=bn,measuring:g,modifiers:p,...w}=n;const m=u.useReducer(Mr,void 0,jr),[v,y]=m,[x,C]=ks(),[b,E]=u.useState(ge.Uninitialized),D=b===ge.Initialized,{draggable:{active:R,nodes:N,translate:A},droppable:{containers:S}}=v,j=R!=null?N.get(R):null,T=u.useRef({initial:null,translated:null}),O=u.useMemo(()=>{var P;return R!=null?{id:R,data:(P=j?.data)!=null?P:Nr,rect:T}:null},[R,j]),J=u.useRef(null),[Ie,qe]=u.useState(null),[_,Ge]=u.useState(null),te=We(w,Object.values(w)),ke=Ke("DndDescribedBy",o),Je=u.useMemo(()=>S.getEnabled(),[S]),V=Ir(g),{droppableRects:ne,measureDroppableContainers:pe,measuringScheduled:Oe}=gr(Je,{dragging:D,dependencies:[A.x,A.y],config:V.droppable}),H=fr(N,R),Qe=u.useMemo(()=>_?at(_):null,[_]),le=Jn(),se=mr(H,V.draggable.measure);kr({activeNode:R!=null?N.get(R):null,config:le.layoutShiftCompensation,initialRect:se,measure:V.draggable.measure});const I=Jt(H,V.draggable.measure,se),Te=Jt(H?H.parentElement:null),Q=u.useRef({activatorEvent:null,active:null,activeNode:H,collisionRect:null,collisions:null,droppableRects:ne,draggableNodes:N,draggingNode:null,draggingNodeRect:null,droppableContainers:S,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),xe=S.getNodeFor((t=Q.current.over)==null?void 0:t.id),re=Er({measure:V.dragOverlay.measure}),ye=(s=re.nodeRef.current)!=null?s:H,we=D?(r=re.rect)!=null?r:I:null,Lt=!!(re.nodeRef.current&&re.rect),Ft=br(Lt?null:I),vt=An(ye?B(ye):null),ce=xr(D?xe??H:null),Ze=Cr(ce),et=Tn(p,{transform:{x:A.x-Ft.x,y:A.y-Ft.y,scaleX:1,scaleY:1},activatorEvent:_,active:O,activeNodeRect:I,containerNodeRect:Te,draggingNodeRect:we,over:Q.current.over,overlayNodeRect:re.rect,scrollableAncestors:ce,scrollableAncestorRects:Ze,windowRect:vt}),$t=Qe?Re(Qe,A):null,Pt=yr(ce),Xn=Zt(Pt),Un=Zt(Pt,[I]),Se=Re(et,Xn),Ce=we?Xs(we,et):null,ze=O&&Ce?f({active:O,collisionRect:Ce,droppableRects:ne,droppableContainers:Je,pointerCoordinates:$t}):null,Bt=Bs(ze,"id"),[ue,Vt]=u.useState(null),Hn=Lt?et:Re(et,Un),Kn=_s(Hn,(i=ue?.rect)!=null?i:null,I),bt=u.useRef(null),_t=u.useCallback((P,W)=>{let{sensor:X,options:de}=W;if(J.current==null)return;const K=N.get(J.current);if(!K)return;const U=P.nativeEvent,Z=new X({active:J.current,activeNode:K,event:U,options:de,context:Q,onAbort($){if(!N.get($))return;const{onDragAbort:ee}=te.current,ie={id:$};ee?.(ie),x({type:"onDragAbort",event:ie})},onPending($,fe,ee,ie){if(!N.get($))return;const{onDragPending:Fe}=te.current,he={id:$,constraint:fe,initialCoordinates:ee,offset:ie};Fe?.(he),x({type:"onDragPending",event:he})},onStart($){const fe=J.current;if(fe==null)return;const ee=N.get(fe);if(!ee)return;const{onDragStart:ie}=te.current,Le={activatorEvent:U,active:{id:fe,data:ee.data,rect:T}};Ne.unstable_batchedUpdates(()=>{ie?.(Le),E(ge.Initializing),y({type:L.DragStart,initialCoordinates:$,active:fe}),x({type:"onDragStart",event:Le}),qe(bt.current),Ge(U)})},onMove($){y({type:L.DragMove,coordinates:$})},onEnd:Ee(L.DragEnd),onCancel:Ee(L.DragCancel)});bt.current=Z;function Ee($){return async function(){const{active:ee,collisions:ie,over:Le,scrollAdjustedTranslate:Fe}=Q.current;let he=null;if(ee&&Fe){const{cancelDrop:$e}=te.current;he={activatorEvent:U,active:ee,collisions:ie,delta:Fe,over:Le},$===L.DragEnd&&typeof $e=="function"&&await Promise.resolve($e(he))&&($=L.DragCancel)}J.current=null,Ne.unstable_batchedUpdates(()=>{y({type:$}),E(ge.Uninitialized),Vt(null),qe(null),Ge(null),bt.current=null;const $e=$===L.DragEnd?"onDragEnd":"onDragCancel";if(he){const xt=te.current[$e];xt?.(he),x({type:$e,event:he})}})}}},[N]),Yn=u.useCallback((P,W)=>(X,de)=>{const K=X.nativeEvent,U=N.get(de);if(J.current!==null||!U||K.dndKit||K.defaultPrevented)return;const Z={active:U};P(X,W.options,Z)===!0&&(K.dndKit={capturedBy:W.sensor},J.current=de,_t(X,W))},[N,_t]),Wt=hr(d,Yn);wr(d),q(()=>{I&&b===ge.Initializing&&E(ge.Initialized)},[I,b]),u.useEffect(()=>{const{onDragMove:P}=te.current,{active:W,activatorEvent:X,collisions:de,over:K}=Q.current;if(!W||!X)return;const U={active:W,activatorEvent:X,collisions:de,delta:{x:Se.x,y:Se.y},over:K};Ne.unstable_batchedUpdates(()=>{P?.(U),x({type:"onDragMove",event:U})})},[Se.x,Se.y]),u.useEffect(()=>{const{active:P,activatorEvent:W,collisions:X,droppableContainers:de,scrollAdjustedTranslate:K}=Q.current;if(!P||J.current==null||!W||!K)return;const{onDragOver:U}=te.current,Z=de.get(Bt),Ee=Z&&Z.rect.current?{id:Z.id,rect:Z.rect.current,data:Z.data,disabled:Z.disabled}:null,$={active:P,activatorEvent:W,collisions:X,delta:{x:K.x,y:K.y},over:Ee};Ne.unstable_batchedUpdates(()=>{Vt(Ee),U?.($),x({type:"onDragOver",event:$})})},[Bt]),q(()=>{Q.current={activatorEvent:_,active:O,activeNode:H,collisionRect:Ce,collisions:ze,droppableRects:ne,draggableNodes:N,draggingNode:ye,draggingNodeRect:we,droppableContainers:S,over:ue,scrollableAncestors:ce,scrollAdjustedTranslate:Se},T.current={initial:we,translated:Ce}},[O,H,ze,Ce,N,ye,we,ne,S,ue,ce,Se]),cr({...le,delta:A,draggingRect:Ce,pointerCoordinates:$t,scrollableAncestors:ce,scrollableAncestorRects:Ze});const qn=u.useMemo(()=>({active:O,activeNode:H,activeNodeRect:I,activatorEvent:_,collisions:ze,containerNodeRect:Te,dragOverlay:re,draggableNodes:N,droppableContainers:S,droppableRects:ne,over:ue,measureDroppableContainers:pe,scrollableAncestors:ce,scrollableAncestorRects:Ze,measuringConfiguration:V,measuringScheduled:Oe,windowRect:vt}),[O,H,I,_,ze,Te,re,N,S,ne,ue,pe,ce,Ze,V,Oe,vt]),Gn=u.useMemo(()=>({activatorEvent:_,activators:Wt,active:O,activeNodeRect:I,ariaDescribedById:{draggable:ke},dispatch:y,draggableNodes:N,over:ue,measureDroppableContainers:pe}),[_,Wt,O,I,y,ke,N,ue,pe]);return k.createElement(vn.Provider,{value:C},k.createElement(Ye.Provider,{value:Gn},k.createElement(On.Provider,{value:qn},k.createElement(pt.Provider,{value:Kn},h)),k.createElement(Ar,{disabled:a?.restoreFocus===!1})),k.createElement(zs,{...a,hiddenTextDescribedById:ke}));function Jn(){const P=Ie?.autoScrollEnabled===!1,W=typeof l=="object"?l.enabled===!1:l===!1,X=D&&!P&&!W;return typeof l=="object"?{...l,enabled:X}:{enabled:X}}}),Tr=u.createContext(null),tn="button",zr="Draggable";function Lr(e){let{id:n,data:t,disabled:s=!1,attributes:r}=e;const i=Ke(zr),{activators:o,activatorEvent:a,active:l,activeNodeRect:h,ariaDescribedById:d,draggableNodes:f,over:g}=u.useContext(Ye),{role:p=tn,roleDescription:w="draggable",tabIndex:m=0}=r??{},v=l?.id===n,y=u.useContext(v?pt:Tr),[x,C]=rt(),[b,E]=rt(),D=Sr(o,n),R=We(t);q(()=>(f.set(n,{id:n,key:i,node:x,activatorNode:b,data:R}),()=>{const A=f.get(n);A&&A.key===i&&f.delete(n)}),[f,n]);const N=u.useMemo(()=>({role:p,tabIndex:m,"aria-disabled":s,"aria-pressed":v&&p===tn?!0:void 0,"aria-roledescription":w,"aria-describedby":d.draggable}),[s,p,m,v,w,d.draggable]);return{active:l,activatorEvent:a,activeNodeRect:h,attributes:N,isDragging:v,listeners:s?void 0:D,node:x,over:g,setNodeRef:C,setActivatorNodeRef:E,transform:y}}function zn(){return u.useContext(On)}const Fr="Droppable",$r={timeout:25};function Ln(e){let{data:n,disabled:t=!1,id:s,resizeObserverConfig:r}=e;const i=Ke(Fr),{active:o,dispatch:a,over:l,measureDroppableContainers:h}=u.useContext(Ye),d=u.useRef({disabled:t}),f=u.useRef(!1),g=u.useRef(null),p=u.useRef(null),{disabled:w,updateMeasurementsFor:m,timeout:v}={...$r,...r},y=We(m??s),x=u.useCallback(()=>{if(!f.current){f.current=!0;return}p.current!=null&&clearTimeout(p.current),p.current=setTimeout(()=>{h(Array.isArray(y.current)?y.current:[y.current]),p.current=null},v)},[v]),C=mt({callback:x,disabled:w||!o}),b=u.useCallback((N,A)=>{C&&(A&&(C.unobserve(A),f.current=!1),N&&C.observe(N))},[C]),[E,D]=rt(b),R=We(n);return u.useEffect(()=>{!C||!E.current||(C.disconnect(),f.current=!1,C.observe(E.current))},[E,C]),u.useEffect(()=>(a({type:L.RegisterDroppable,element:{id:s,key:i,disabled:t,node:E,rect:g,data:R}}),()=>a({type:L.UnregisterDroppable,key:i,id:s})),[s]),u.useEffect(()=>{t!==d.current.disabled&&(a({type:L.SetDroppableDisabled,id:s,key:i,disabled:t}),d.current.disabled=t)},[s,i,t,a]),{active:o,rect:g,isOver:l?.id===s,node:E,over:l,setNodeRef:D}}function Pr(e){let{animation:n,children:t}=e;const[s,r]=u.useState(null),[i,o]=u.useState(null),a=it(t);return!t&&!s&&a&&r(a),q(()=>{if(!i)return;const l=s?.key,h=s?.props.id;if(l==null||h==null){r(null);return}Promise.resolve(n(h,i)).then(()=>{r(null)})},[n,s,i]),k.createElement(k.Fragment,null,t,s?u.cloneElement(s,{ref:o}):null)}const Br={x:0,y:0,scaleX:1,scaleY:1};function Vr(e){let{children:n}=e;return k.createElement(Ye.Provider,{value:kn},k.createElement(pt.Provider,{value:Br},n))}const _r={position:"fixed",touchAction:"none"},Wr=e=>gt(e)?"transform 250ms ease":void 0,Xr=u.forwardRef((e,n)=>{let{as:t,activatorEvent:s,adjustScale:r,children:i,className:o,rect:a,style:l,transform:h,transition:d=Wr}=e;if(!a)return null;const f=r?h:{...h,scaleX:1,scaleY:1},g={..._r,width:a.width,height:a.height,top:a.top,left:a.left,transform:me.Transform.toString(f),transformOrigin:r&&s?$s(s,a):void 0,transition:typeof d=="function"?d(s):d,...l};return k.createElement(t,{className:o,style:g,ref:n},i)}),Ur=e=>n=>{let{active:t,dragOverlay:s}=n;const r={},{styles:i,className:o}=e;if(i!=null&&i.active)for(const[a,l]of Object.entries(i.active))l!==void 0&&(r[a]=t.node.style.getPropertyValue(a),t.node.style.setProperty(a,l));if(i!=null&&i.dragOverlay)for(const[a,l]of Object.entries(i.dragOverlay))l!==void 0&&s.node.style.setProperty(a,l);return o!=null&&o.active&&t.node.classList.add(o.active),o!=null&&o.dragOverlay&&s.node.classList.add(o.dragOverlay),function(){for(const[l,h]of Object.entries(r))t.node.style.setProperty(l,h);o!=null&&o.active&&t.node.classList.remove(o.active)}},Hr=e=>{let{transform:{initial:n,final:t}}=e;return[{transform:me.Transform.toString(n)},{transform:me.Transform.toString(t)}]},Kr={duration:250,easing:"ease",keyframes:Hr,sideEffects:Ur({styles:{active:{opacity:"0"}}})};function Yr(e){let{config:n,draggableNodes:t,droppableContainers:s,measuringConfiguration:r}=e;return ht((i,o)=>{if(n===null)return;const a=t.get(i);if(!a)return;const l=a.node.current;if(!l)return;const h=In(o);if(!h)return;const{transform:d}=B(o).getComputedStyle(o),f=yn(d);if(!f)return;const g=typeof n=="function"?n:qr(n);return Rn(l,r.draggable.measure),g({active:{id:i,data:a.data,node:l,rect:r.draggable.measure(l)},draggableNodes:t,dragOverlay:{node:o,rect:r.dragOverlay.measure(h)},droppableContainers:s,measuringConfiguration:r,transform:f})})}function qr(e){const{duration:n,easing:t,sideEffects:s,keyframes:r}={...Kr,...e};return i=>{let{active:o,dragOverlay:a,transform:l,...h}=i;if(!n)return;const d={x:a.rect.left-o.rect.left,y:a.rect.top-o.rect.top},f={scaleX:l.scaleX!==1?o.rect.width*l.scaleX/a.rect.width:1,scaleY:l.scaleY!==1?o.rect.height*l.scaleY/a.rect.height:1},g={x:l.x-d.x,y:l.y-d.y,...f},p=r({...h,active:o,dragOverlay:a,transform:{initial:l,final:g}}),[w]=p,m=p[p.length-1];if(JSON.stringify(w)===JSON.stringify(m))return;const v=s?.({active:o,dragOverlay:a,...h}),y=a.node.animate(p,{duration:n,easing:t,fill:"forwards"});return new Promise(x=>{y.onfinish=()=>{v?.(),x()}})}}let nn=0;function Gr(e){return u.useMemo(()=>{if(e!=null)return nn++,nn},[e])}const Jr=k.memo(e=>{let{adjustScale:n=!1,children:t,dropAnimation:s,style:r,transition:i,modifiers:o,wrapperElement:a="div",className:l,zIndex:h=999}=e;const{activatorEvent:d,active:f,activeNodeRect:g,containerNodeRect:p,draggableNodes:w,droppableContainers:m,dragOverlay:v,over:y,measuringConfiguration:x,scrollableAncestors:C,scrollableAncestorRects:b,windowRect:E}=zn(),D=u.useContext(pt),R=Gr(f?.id),N=Tn(o,{activatorEvent:d,active:f,activeNodeRect:g,containerNodeRect:p,draggingNodeRect:v.rect,over:y,overlayNodeRect:v.rect,scrollableAncestors:C,scrollableAncestorRects:b,transform:D,windowRect:E}),A=zt(g),S=Yr({config:s,draggableNodes:w,droppableContainers:m,measuringConfiguration:x}),j=A?v.setRef:void 0;return k.createElement(Vr,null,k.createElement(Pr,{animation:S},f&&R?k.createElement(Xr,{key:R,id:f.id,ref:j,as:a,activatorEvent:d,adjustScale:n,className:l,transition:i,rect:A,style:{zIndex:h,...r},transform:N},t):null))});function Fn(e,n,t){const s=e.slice();return s.splice(t<0?s.length+t:t,0,s.splice(n,1)[0]),s}function Qr(e,n){return e.reduce((t,s,r)=>{const i=n.get(s);return i&&(t[r]=i),t},Array(e.length))}function tt(e){return e!==null&&e>=0}function Zr(e,n){if(e===n)return!0;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t]!==n[t])return!1;return!0}function ei(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const $n=e=>{let{rects:n,activeIndex:t,overIndex:s,index:r}=e;const i=Fn(n,s,t),o=n[r],a=i[r];return!a||!o?null:{x:a.left-o.left,y:a.top-o.top,scaleX:a.width/o.width,scaleY:a.height/o.height}},nt={scaleX:1,scaleY:1},ti=e=>{var n;let{activeIndex:t,activeNodeRect:s,index:r,rects:i,overIndex:o}=e;const a=(n=i[t])!=null?n:s;if(!a)return null;if(r===t){const h=i[o];return h?{x:0,y:t<o?h.top+h.height-(a.top+a.height):h.top-a.top,...nt}:null}const l=ni(i,r,t);return r>t&&r<=o?{x:0,y:-a.height-l,...nt}:r<t&&r>=o?{x:0,y:a.height+l,...nt}:{x:0,y:0,...nt}};function ni(e,n,t){const s=e[n],r=e[n-1],i=e[n+1];return s?t<n?r?s.top-(r.top+r.height):i?i.top-(s.top+s.height):0:i?i.top-(s.top+s.height):r?s.top-(r.top+r.height):0:0}const Pn="Sortable",Bn=k.createContext({activeIndex:-1,containerId:Pn,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:$n,disabled:{draggable:!1,droppable:!1}});function si(e){let{children:n,id:t,items:s,strategy:r=$n,disabled:i=!1}=e;const{active:o,dragOverlay:a,droppableRects:l,over:h,measureDroppableContainers:d}=zn(),f=Ke(Pn,t),g=a.rect!==null,p=u.useMemo(()=>s.map(D=>typeof D=="object"&&"id"in D?D.id:D),[s]),w=o!=null,m=o?p.indexOf(o.id):-1,v=h?p.indexOf(h.id):-1,y=u.useRef(p),x=!Zr(p,y.current),C=v!==-1&&m===-1||x,b=ei(i);q(()=>{x&&w&&d(p)},[x,p,w,d]),u.useEffect(()=>{y.current=p},[p]);const E=u.useMemo(()=>({activeIndex:m,containerId:f,disabled:b,disableTransforms:C,items:p,overIndex:v,useDragOverlay:g,sortedRects:Qr(p,l),strategy:r}),[m,f,b.draggable,b.droppable,C,p,v,l,g,r]);return k.createElement(Bn.Provider,{value:E},n)}const ri=e=>{let{id:n,items:t,activeIndex:s,overIndex:r}=e;return Fn(t,s,r).indexOf(n)},ii=e=>{let{containerId:n,isSorting:t,wasDragging:s,index:r,items:i,newIndex:o,previousItems:a,previousContainerId:l,transition:h}=e;return!h||!s||a!==i&&r===o?!1:t?!0:o!==r&&n===l},oi={duration:200,easing:"ease"},Vn="transform",ai=me.Transition.toString({property:Vn,duration:0,easing:"linear"}),li={roleDescription:"sortable"};function ci(e){let{disabled:n,index:t,node:s,rect:r}=e;const[i,o]=u.useState(null),a=u.useRef(t);return q(()=>{if(!n&&t!==a.current&&s.current){const l=r.current;if(l){const h=Ae(s.current,{ignoreTransform:!0}),d={x:l.left-h.left,y:l.top-h.top,scaleX:l.width/h.width,scaleY:l.height/h.height};(d.x||d.y)&&o(d)}}t!==a.current&&(a.current=t)},[n,t,s,r]),u.useEffect(()=>{i&&o(null)},[i]),i}function ui(e){let{animateLayoutChanges:n=ii,attributes:t,disabled:s,data:r,getNewIndex:i=ri,id:o,strategy:a,resizeObserverConfig:l,transition:h=oi}=e;const{items:d,containerId:f,activeIndex:g,disabled:p,disableTransforms:w,sortedRects:m,overIndex:v,useDragOverlay:y,strategy:x}=u.useContext(Bn),C=di(s,p),b=d.indexOf(o),E=u.useMemo(()=>({sortable:{containerId:f,index:b,items:d},...r}),[f,r,b,d]),D=u.useMemo(()=>d.slice(d.indexOf(o)),[d,o]),{rect:R,node:N,isOver:A,setNodeRef:S}=Ln({id:o,data:E,disabled:C.droppable,resizeObserverConfig:{updateMeasurementsFor:D,...l}}),{active:j,activatorEvent:T,activeNodeRect:O,attributes:J,setNodeRef:Ie,listeners:qe,isDragging:_,over:Ge,setActivatorNodeRef:te,transform:ke}=Lr({id:o,data:E,attributes:{...li,...t},disabled:C.draggable}),Je=Ss(S,Ie),V=!!j,ne=V&&!w&&tt(g)&&tt(v),pe=!y&&_,Oe=pe&&ne?ke:null,Qe=ne?Oe??(a??x)({rects:m,activeNodeRect:O,activeIndex:g,overIndex:v,index:b}):null,le=tt(g)&&tt(v)?i({id:o,items:d,activeIndex:g,overIndex:v}):b,se=j?.id,I=u.useRef({activeId:se,items:d,newIndex:le,containerId:f}),Te=d!==I.current.items,Q=n({active:j,containerId:f,isDragging:_,isSorting:V,id:o,index:b,items:d,newIndex:I.current.newIndex,previousItems:I.current.items,previousContainerId:I.current.containerId,transition:h,wasDragging:I.current.activeId!=null}),xe=ci({disabled:!Q,index:b,node:N,rect:R});return u.useEffect(()=>{V&&I.current.newIndex!==le&&(I.current.newIndex=le),f!==I.current.containerId&&(I.current.containerId=f),d!==I.current.items&&(I.current.items=d)},[V,le,f,d]),u.useEffect(()=>{if(se===I.current.activeId)return;if(se!=null&&I.current.activeId==null){I.current.activeId=se;return}const ye=setTimeout(()=>{I.current.activeId=se},50);return()=>clearTimeout(ye)},[se]),{active:j,activeIndex:g,attributes:J,data:E,rect:R,index:b,newIndex:le,items:d,isOver:A,isSorting:V,isDragging:_,listeners:qe,node:N,overIndex:v,over:Ge,setNodeRef:Je,setActivatorNodeRef:te,setDroppableNodeRef:S,setDraggableNodeRef:Ie,transform:xe??Qe,transition:re()};function re(){if(xe||Te&&I.current.newIndex===b)return ai;if(!(pe&&!gt(T)||!h)&&(V||Q))return me.Transition.toString({...h,property:Vn})}}function di(e,n){var t,s;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(t=e?.draggable)!=null?t:n.draggable,droppable:(s=e?.droppable)!=null?s:n.droppable}}M.Down,M.Right,M.Up,M.Left;function _n({company:e}){const n=dn(),{attributes:t,listeners:s,setNodeRef:r,transform:i,transition:o,isDragging:a}=ui({id:e.id}),l={transform:me.Transform.toString(i),transition:o,opacity:a?.3:1},h=()=>{a||n(`/customers/${e.id}`)};return c.jsxs(z.div,{ref:r,style:l,...t,...s,onClick:h,initial:{opacity:0,y:20},animate:{opacity:a?.3:1,y:0},whileHover:{y:-4,boxShadow:"0 8px 24px rgba(0,0,0,0.3)"},transition:{duration:.2},className:"bg-surface-800/60 border border-surface-700/50 rounded-lg p-3 cursor-grab active:cursor-grabbing hover:border-surface-600 transition-colors",children:[c.jsx("div",{className:"text-sm font-medium text-surface-100 truncate",children:e.name}),e.estimatedValue>0&&c.jsx("div",{className:"text-xs text-brand-400 mt-1",children:hn(e.estimatedValue,!1)}),e.tags&&e.tags.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:e.tags.slice(0,2).map(d=>c.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-surface-700/50 text-surface-400 rounded",children:d},d))})]})}function fi({stage:e,companies:n}){const{setNodeRef:t,isOver:s}=Ln({id:e.key});return c.jsxs(z.div,{ref:t,variants:oe,className:`flex flex-col ${s?"ring-2 ring-brand-500/50 rounded-xl":""}`,children:[c.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-t-xl border-t-2 ${e.borderColor} bg-surface-800/40`,children:[c.jsx(e.icon,{className:`w-4 h-4 ${e.color}`}),c.jsx("span",{className:`text-sm font-semibold ${e.color}`,children:e.label}),c.jsx("span",{className:"ml-auto text-xs text-surface-500 bg-surface-700/50 px-1.5 py-0.5 rounded-full",children:n.length})]}),c.jsx("div",{className:"flex-1 p-2 space-y-2 bg-surface-800/20 rounded-b-xl min-h-[120px]",children:c.jsx(si,{items:n.map(r=>r.id),strategy:ti,children:n.map(r=>c.jsx(_n,{company:r},r.id))})})]})}function hi({companies:e,onRefresh:n}){const{updateStage:t}=dt(),{logStageChange:s}=hs(),{user:r}=jt(),[i,o]=u.useState(null),a=Fs(Ls(Tt,{activationConstraint:{distance:8}})),l=g=>{o(g.active.id)},h=async g=>{o(null);const{active:p,over:w}=g;if(!w)return;const m=p.id,v=w.id,y=e.find(x=>x.id===m);if(!(!y||y.pipelineStage===v))try{await t(m,v),await s(m,y.pipelineStage,v,r?.id||""),be.success(`Moved ${y.name} to ${v.replace("-"," ")}`),n()}catch(x){console.error("Failed to update stage:",x),be.error("Failed to update pipeline stage")}},d=i?e.find(g=>g.id===i):null,f=new Map;for(const g of Pe)f.set(g.key,[]);for(const g of e){const p=f.get(g.pipelineStage)||f.get("lead");p&&p.push(g)}return c.jsxs(Or,{sensors:a,collisionDetection:bn,onDragStart:l,onDragEnd:h,children:[c.jsx("div",{className:"overflow-x-auto pb-2",children:c.jsx(z.div,{className:"grid gap-2",style:{gridTemplateColumns:`repeat(${Pe.length}, minmax(240px, 1fr))`},variants:ut,initial:"hidden",animate:"visible",children:Pe.map(g=>c.jsx(fi,{stage:g,companies:f.get(g.key)||[]},g.key))})}),c.jsx(Jr,{children:d?c.jsx(_n,{company:d}):null})]})}function De(e,n,t){let s=t.initialDeps??[],r,i=!0;function o(){var a,l,h;let d;t.key&&((a=t.debug)!=null&&a.call(t))&&(d=Date.now());const f=e();if(!(f.length!==s.length||f.some((w,m)=>s[m]!==w)))return r;s=f;let p;if(t.key&&((l=t.debug)!=null&&l.call(t))&&(p=Date.now()),r=n(...f),t.key&&((h=t.debug)!=null&&h.call(t))){const w=Math.round((Date.now()-d)*100)/100,m=Math.round((Date.now()-p)*100)/100,v=m/16,y=(x,C)=>{for(x=String(x);x.length<C;)x=" "+x;return x};console.info(`%c ${y(m,5)} /${y(w,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*v,120))}deg 100% 31%);`,t?.key)}return t?.onChange&&!(i&&t.skipInitialOnChange)&&t.onChange(r),i=!1,r}return o.updateDeps=a=>{s=a},o}function sn(e,n){if(e===void 0)throw new Error("Unexpected undefined");return e}const gi=(e,n)=>Math.abs(e-n)<1.01,mi=(e,n,t)=>{let s;return function(...r){e.clearTimeout(s),s=e.setTimeout(()=>n.apply(this,r),t)}},rn=e=>{const{offsetWidth:n,offsetHeight:t}=e;return{width:n,height:t}},pi=e=>e,vi=e=>{const n=Math.max(e.startIndex-e.overscan,0),t=Math.min(e.endIndex+e.overscan,e.count-1),s=[];for(let r=n;r<=t;r++)s.push(r);return s},bi=(e,n)=>{const t=e.scrollElement;if(!t)return;const s=e.targetWindow;if(!s)return;const r=o=>{const{width:a,height:l}=o;n({width:Math.round(a),height:Math.round(l)})};if(r(rn(t)),!s.ResizeObserver)return()=>{};const i=new s.ResizeObserver(o=>{const a=()=>{const l=o[0];if(l?.borderBoxSize){const h=l.borderBoxSize[0];if(h){r({width:h.inlineSize,height:h.blockSize});return}}r(rn(t))};e.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(a):a()});return i.observe(t,{box:"border-box"}),()=>{i.unobserve(t)}},on={passive:!0},an=typeof window>"u"?!0:"onscrollend"in window,xi=(e,n)=>{const t=e.scrollElement;if(!t)return;const s=e.targetWindow;if(!s)return;let r=0;const i=e.options.useScrollendEvent&&an?()=>{}:mi(s,()=>{n(r,!1)},e.options.isScrollingResetDelay),o=d=>()=>{const{horizontal:f,isRtl:g}=e.options;r=f?t.scrollLeft*(g&&-1||1):t.scrollTop,i(),n(r,d)},a=o(!0),l=o(!1);t.addEventListener("scroll",a,on);const h=e.options.useScrollendEvent&&an;return h&&t.addEventListener("scrollend",l,on),()=>{t.removeEventListener("scroll",a),h&&t.removeEventListener("scrollend",l)}},yi=(e,n,t)=>{if(n?.borderBoxSize){const s=n.borderBoxSize[0];if(s)return Math.round(s[t.options.horizontal?"inlineSize":"blockSize"])}return e[t.options.horizontal?"offsetWidth":"offsetHeight"]},wi=(e,{adjustments:n=0,behavior:t},s)=>{var r,i;const o=e+n;(i=(r=s.scrollElement)==null?void 0:r.scrollTo)==null||i.call(r,{[s.options.horizontal?"left":"top"]:o,behavior:t})};class Si{constructor(n){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.currentScrollToIndex=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let t=null;const s=()=>t||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:t=new this.targetWindow.ResizeObserver(r=>{r.forEach(i=>{const o=()=>{this._measureElement(i.target,i)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(o):o()})}));return{disconnect:()=>{var r;(r=s())==null||r.disconnect(),t=null},observe:r=>{var i;return(i=s())==null?void 0:i.observe(r,{box:"border-box"})},unobserve:r=>{var i;return(i=s())==null?void 0:i.unobserve(r)}}})(),this.range=null,this.setOptions=t=>{Object.entries(t).forEach(([s,r])=>{typeof r>"u"&&delete t[s]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:pi,rangeExtractor:vi,onChange:()=>{},measureElement:yi,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...t}},this.notify=t=>{var s,r;(r=(s=this.options).onChange)==null||r.call(s,this,t)},this.maybeNotify=De(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),t=>{this.notify(t)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(t=>t()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var t;const s=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==s){if(this.cleanup(),!s){this.maybeNotify();return}this.scrollElement=s,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((t=this.scrollElement)==null?void 0:t.window)??null,this.elementsCache.forEach(r=>{this.observer.observe(r)}),this.unsubs.push(this.options.observeElementRect(this,r=>{this.scrollRect=r,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(r,i)=>{this.scrollAdjustments=0,this.scrollDirection=i?this.getScrollOffset()<r?"forward":"backward":null,this.scrollOffset=r,this.isScrolling=i,this.maybeNotify()})),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0})}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(t,s)=>{const r=new Map,i=new Map;for(let o=s-1;o>=0;o--){const a=t[o];if(r.has(a.lane))continue;const l=i.get(a.lane);if(l==null||a.end>l.end?i.set(a.lane,a):a.end<l.end&&r.set(a.lane,!0),r.size===this.options.lanes)break}return i.size===this.options.lanes?Array.from(i.values()).sort((o,a)=>o.end===a.end?o.index-a.index:o.end-a.end)[0]:void 0},this.getMeasurementOptions=De(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(t,s,r,i,o,a)=>(this.prevLanes!==void 0&&this.prevLanes!==a&&(this.lanesChangedFlag=!0),this.prevLanes=a,this.pendingMeasuredCacheIndexes=[],{count:t,paddingStart:s,scrollMargin:r,getItemKey:i,enabled:o,lanes:a}),{key:!1}),this.getMeasurements=De(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:t,paddingStart:s,scrollMargin:r,getItemKey:i,enabled:o,lanes:a},l)=>{if(!o)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>t)for(const g of this.laneAssignments.keys())g>=t&&this.laneAssignments.delete(g);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),this.measurementsCache.length===0&&!this.lanesSettling&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(g=>{this.itemSizeCache.set(g.key,g.size)}));const h=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===t&&(this.lanesSettling=!1);const d=this.measurementsCache.slice(0,h),f=new Array(a).fill(void 0);for(let g=0;g<h;g++){const p=d[g];p&&(f[p.lane]=g)}for(let g=h;g<t;g++){const p=i(g),w=this.laneAssignments.get(g);let m,v;if(w!==void 0&&this.options.lanes>1){m=w;const b=f[m],E=b!==void 0?d[b]:void 0;v=E?E.end+this.options.gap:s+r}else{const b=this.options.lanes===1?d[g-1]:this.getFurthestMeasurement(d,g);v=b?b.end+this.options.gap:s+r,m=b?b.lane:g%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(g,m)}const y=l.get(p),x=typeof y=="number"?y:this.options.estimateSize(g),C=v+x;d[g]={index:g,start:v,size:x,end:C,key:p,lane:m},f[m]=g}return this.measurementsCache=d,d},{key:!1,debug:()=>this.options.debug}),this.calculateRange=De(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(t,s,r,i)=>this.range=t.length>0&&s>0?Ci({measurements:t,outerSize:s,scrollOffset:r,lanes:i}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=De(()=>{let t=null,s=null;const r=this.calculateRange();return r&&(t=r.startIndex,s=r.endIndex),this.maybeNotify.updateDeps([this.isScrolling,t,s]),[this.options.rangeExtractor,this.options.overscan,this.options.count,t,s]},(t,s,r,i,o)=>i===null||o===null?[]:t({startIndex:i,endIndex:o,overscan:s,count:r}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=t=>{const s=this.options.indexAttribute,r=t.getAttribute(s);return r?parseInt(r,10):(console.warn(`Missing attribute name '${s}={index}' on measured element.`),-1)},this._measureElement=(t,s)=>{const r=this.indexFromElement(t),i=this.measurementsCache[r];if(!i)return;const o=i.key,a=this.elementsCache.get(o);a!==t&&(a&&this.observer.unobserve(a),this.observer.observe(t),this.elementsCache.set(o,t)),t.isConnected&&this.resizeItem(r,this.options.measureElement(t,s,this))},this.resizeItem=(t,s)=>{const r=this.measurementsCache[t];if(!r)return;const i=this.itemSizeCache.get(r.key)??r.size,o=s-i;o!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(r,o,this):r.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=o,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(r.index),this.itemSizeCache=new Map(this.itemSizeCache.set(r.key,s)),this.notify(!1))},this.measureElement=t=>{if(!t){this.elementsCache.forEach((s,r)=>{s.isConnected||(this.observer.unobserve(s),this.elementsCache.delete(r))});return}this._measureElement(t,void 0)},this.getVirtualItems=De(()=>[this.getVirtualIndexes(),this.getMeasurements()],(t,s)=>{const r=[];for(let i=0,o=t.length;i<o;i++){const a=t[i],l=s[a];r.push(l)}return r},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=t=>{const s=this.getMeasurements();if(s.length!==0)return sn(s[Wn(0,s.length-1,r=>sn(s[r]).start,t)])},this.getMaxScrollOffset=()=>{if(!this.scrollElement)return 0;if("scrollHeight"in this.scrollElement)return this.options.horizontal?this.scrollElement.scrollWidth-this.scrollElement.clientWidth:this.scrollElement.scrollHeight-this.scrollElement.clientHeight;{const t=this.scrollElement.document.documentElement;return this.options.horizontal?t.scrollWidth-this.scrollElement.innerWidth:t.scrollHeight-this.scrollElement.innerHeight}},this.getOffsetForAlignment=(t,s,r=0)=>{if(!this.scrollElement)return 0;const i=this.getSize(),o=this.getScrollOffset();s==="auto"&&(s=t>=o+i?"end":"start"),s==="center"?t+=(r-i)/2:s==="end"&&(t-=i);const a=this.getMaxScrollOffset();return Math.max(Math.min(a,t),0)},this.getOffsetForIndex=(t,s="auto")=>{t=Math.max(0,Math.min(t,this.options.count-1));const r=this.measurementsCache[t];if(!r)return;const i=this.getSize(),o=this.getScrollOffset();if(s==="auto")if(r.end>=o+i-this.options.scrollPaddingEnd)s="end";else if(r.start<=o+this.options.scrollPaddingStart)s="start";else return[o,s];if(s==="end"&&t===this.options.count-1)return[this.getMaxScrollOffset(),s];const a=s==="end"?r.end+this.options.scrollPaddingEnd:r.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(a,s,r.size),s]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(t,{align:s="start",behavior:r}={})=>{r==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(t,s),{adjustments:void 0,behavior:r})},this.scrollToIndex=(t,{align:s="auto",behavior:r}={})=>{r==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),t=Math.max(0,Math.min(t,this.options.count-1)),this.currentScrollToIndex=t;let i=0;const o=10,a=h=>{if(!this.targetWindow)return;const d=this.getOffsetForIndex(t,h);if(!d){console.warn("Failed to get offset for index:",t);return}const[f,g]=d;this._scrollToOffset(f,{adjustments:void 0,behavior:r}),this.targetWindow.requestAnimationFrame(()=>{const p=()=>{if(this.currentScrollToIndex!==t)return;const w=this.getScrollOffset(),m=this.getOffsetForIndex(t,g);if(!m){console.warn("Failed to get offset for index:",t);return}gi(m[0],w)||l(g)};this.isDynamicMode()?this.targetWindow.requestAnimationFrame(p):p()})},l=h=>{this.targetWindow&&this.currentScrollToIndex===t&&(i++,i<o?this.targetWindow.requestAnimationFrame(()=>a(h)):console.warn(`Failed to scroll to index ${t} after ${o} attempts.`))};a(s)},this.scrollBy=(t,{behavior:s}={})=>{s==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+t,{adjustments:void 0,behavior:s})},this.getTotalSize=()=>{var t;const s=this.getMeasurements();let r;if(s.length===0)r=this.options.paddingStart;else if(this.options.lanes===1)r=((t=s[s.length-1])==null?void 0:t.end)??0;else{const i=Array(this.options.lanes).fill(null);let o=s.length-1;for(;o>=0&&i.some(a=>a===null);){const a=s[o];i[a.lane]===null&&(i[a.lane]=a.end),o--}r=Math.max(...i.filter(a=>a!==null))}return Math.max(r-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(t,{adjustments:s,behavior:r})=>{this.options.scrollToFn(t,{behavior:r,adjustments:s},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(n)}}const Wn=(e,n,t,s)=>{for(;e<=n;){const r=(e+n)/2|0,i=t(r);if(i<s)e=r+1;else if(i>s)n=r-1;else return r}return e>0?e-1:0};function Ci({measurements:e,outerSize:n,scrollOffset:t,lanes:s}){const r=e.length-1,i=l=>e[l].start;if(e.length<=s)return{startIndex:0,endIndex:r};let o=Wn(0,r,i,t),a=o;if(s===1)for(;a<r&&e[a].end<t+n;)a++;else if(s>1){const l=Array(s).fill(0);for(;a<r&&l.some(d=>d<t+n);){const d=e[a];l[d.lane]=d.end,a++}const h=Array(s).fill(t+n);for(;o>=0&&h.some(d=>d>=t);){const d=e[o];h[d.lane]=d.start,o--}o=Math.max(0,o-o%s),a=Math.min(r,a+(s-1-a%s))}return{startIndex:o,endIndex:a}}const ln=typeof document<"u"?u.useLayoutEffect:u.useEffect;function Ei({useFlushSync:e=!0,...n}){const t=u.useReducer(()=>({}),{})[1],s={...n,onChange:(i,o)=>{var a;e&&o?Ne.flushSync(t):t(),(a=n.onChange)==null||a.call(n,i,o)}},[r]=u.useState(()=>new Si(s));return r.setOptions(s),ln(()=>r._didMount(),[]),ln(()=>r._willUpdate()),r}function Di(e){return Ei({observeElementRect:bi,observeElementOffset:xi,scrollToFn:wi,...e})}function cn({company:e,selected:n,onToggle:t,userNameMap:s}){const r=dn();return c.jsxs(z.tr,{variants:oe,whileHover:{backgroundColor:"rgba(0, 212, 255, 0.04)"},onClick:()=>r(`/customers/${e.id}`),className:"border-b border-surface-700/30 hover:bg-surface-700/20 transition-colors cursor-pointer",children:[t!==void 0&&c.jsx("td",{className:"px-4 py-3 w-10",onClick:i=>i.stopPropagation(),children:c.jsx("input",{type:"checkbox",checked:n??!1,onChange:()=>t(e.id),className:"accent-brand-500"})}),c.jsx("td",{className:"px-4 py-3 text-sm text-surface-100 font-medium",children:e.name}),c.jsx("td",{className:"px-4 py-3",children:c.jsx(gs,{stage:e.pipelineStage})}),c.jsx("td",{className:"px-4 py-3 text-sm text-surface-300",children:e.estimatedValue>0?hn(e.estimatedValue,!1):""}),c.jsx("td",{className:"px-4 py-3 text-sm text-surface-400",children:e.assignedTo&&s?.[e.assignedTo]||e.assignedTo||""}),c.jsx("td",{className:"px-4 py-3 text-xs text-surface-500",children:new Date(e.updatedAt).toLocaleDateString("en-ZA")}),c.jsx("td",{className:"px-4 py-3 text-xs text-surface-500",children:new Date(e.createdAt).toLocaleDateString("en-ZA")})]})}const Ni=100,Ri=48;function ji({companies:e,selectedIds:n,onSelectionChange:t,userNameMap:s}){const[r,i]=u.useState("updatedAt"),[o,a]=u.useState(!1),l=u.useRef(null),h=b=>{r===b?a(!o):(i(b),a(!0))},d=[...e].sort((b,E)=>{let D=0;switch(r){case"name":D=b.name.localeCompare(E.name);break;case"pipelineStage":D=b.pipelineStage.localeCompare(E.pipelineStage);break;case"estimatedValue":D=(b.estimatedValue||0)-(E.estimatedValue||0);break;case"updatedAt":D=b.updatedAt.localeCompare(E.updatedAt);break;case"createdAt":D=b.createdAt.localeCompare(E.createdAt);break}return o?D:-D}),f=d.length>Ni,g=Di({count:d.length,getScrollElement:()=>l.current,estimateSize:()=>Ri,overscan:10,enabled:f}),p=({field:b})=>r!==b?null:o?c.jsx(ns,{className:"w-3 h-3 inline ml-1"}):c.jsx(ss,{className:"w-3 h-3 inline ml-1"}),w=!!t,m=w&&d.length>0&&d.every(b=>n?.has(b.id)),v=b=>{if(!t||!n)return;const E=new Set(n);E.has(b)?E.delete(b):E.add(b),t(E)},y=()=>{t&&t(m?new Set:new Set(d.map(b=>b.id)))},x="px-4 py-3 text-left text-xs font-semibold text-surface-400 uppercase tracking-wider cursor-pointer hover:text-surface-200 transition-colors",C=w?7:6;return c.jsx("div",{className:"glass rounded-xl overflow-hidden",children:c.jsx("div",{ref:l,className:`overflow-x-auto ${f?"max-h-[70vh] overflow-y-auto":""}`,children:c.jsxs("table",{className:"w-full",children:[c.jsx("thead",{className:f?"sticky top-0 z-10 bg-surface-900/95 backdrop-blur-sm":"",children:c.jsxs("tr",{className:"border-b border-surface-700/50",children:[w&&c.jsx("th",{className:"px-4 py-3 w-10",children:c.jsx("input",{type:"checkbox",checked:m,onChange:y,className:"accent-brand-500"})}),c.jsxs("th",{className:x,onClick:()=>h("name"),children:["Name ",c.jsx(p,{field:"name"})]}),c.jsxs("th",{className:x,onClick:()=>h("pipelineStage"),children:["Stage ",c.jsx(p,{field:"pipelineStage"})]}),c.jsxs("th",{className:x,onClick:()=>h("estimatedValue"),children:["Value ",c.jsx(p,{field:"estimatedValue"})]}),c.jsx("th",{className:x,children:"Assigned To"}),c.jsxs("th",{className:x,onClick:()=>h("updatedAt"),children:["Last Activity ",c.jsx(p,{field:"updatedAt"})]}),c.jsxs("th",{className:x,onClick:()=>h("createdAt"),children:["Created ",c.jsx(p,{field:"createdAt"})]})]})}),d.length===0?c.jsx("tbody",{children:c.jsx("tr",{children:c.jsx("td",{colSpan:C,className:"px-4 py-12 text-center text-surface-500",children:c.jsxs("div",{className:"flex flex-col items-center",children:[c.jsx(z.div,{animate:{y:[-4,4,-4]},transition:{duration:4,repeat:1/0,ease:"easeInOut"},children:c.jsx(gn,{className:"w-10 h-10 text-surface-600 mb-3"})}),c.jsx("div",{className:"text-sm font-medium text-surface-400",children:"No companies found"}),c.jsx("div",{className:"text-xs text-surface-600 mt-1",children:"Try adjusting your search or filters"})]})})})}):f?c.jsxs("tbody",{children:[g.getVirtualItems().length>0&&c.jsx("tr",{"aria-hidden":"true",children:c.jsx("td",{colSpan:C,style:{height:g.getVirtualItems()[0].start,padding:0}})}),g.getVirtualItems().map(b=>c.jsx(cn,{company:d[b.index],selected:n?.has(d[b.index].id),onToggle:w?v:void 0,userNameMap:s},d[b.index].id)),g.getVirtualItems().length>0&&c.jsx("tr",{"aria-hidden":"true",children:c.jsx("td",{colSpan:C,style:{height:g.getTotalSize()-(g.getVirtualItems().at(-1)?.end??0),padding:0}})})]}):c.jsx(z.tbody,{variants:ut,initial:"hidden",animate:"visible",children:d.map(b=>c.jsx(cn,{company:b,selected:n?.has(b.id),onToggle:w?v:void 0,userNameMap:s},b.id))})]})})})}function Mi({selectedCount:e,selectedIds:n,onClearSelection:t,onRefresh:s}){const[r,i]=u.useState(""),{updateStage:o,deleteCompany:a}=dt(),{confirm:l,ConfirmDialogElement:h}=rs();if(e===0)return null;const d=async()=>{if(!r||!await l({title:"Bulk Update Stage",message:`Move ${e} ${e===1?"company":"companies"} to "${r}" stage?`,variant:"info",confirmText:"Update"}))return;let p=0;for(const w of n)try{await o(w,r),p++}catch{}be.success(`Updated ${p} ${p===1?"company":"companies"}`),i(""),t(),s()},f=async()=>{if(!await l({title:"Bulk Delete",message:`Are you sure you want to delete ${e} ${e===1?"company":"companies"}? This action cannot be undone.`,variant:"danger",confirmText:"Delete All"}))return;let p=0;for(const w of n)try{await a(w),p++}catch{}be.success(`Deleted ${p} ${p===1?"company":"companies"}`),t(),s()};return c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"glass rounded-xl p-3 flex items-center gap-3 flex-wrap animate-in slide-in-from-top-2",children:[c.jsxs("div",{className:"text-sm text-surface-200 font-medium",children:[e," selected"]}),c.jsx("button",{onClick:t,className:"text-surface-400 hover:text-surface-200 transition-colors",title:"Clear selection",children:c.jsx(is,{className:"w-4 h-4"})}),c.jsx("div",{className:"h-5 w-px bg-surface-700"}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(ms,{className:"w-4 h-4 text-surface-400"}),c.jsxs("select",{value:r,onChange:g=>i(g.target.value),className:"input text-sm py-1.5",children:[c.jsx("option",{value:"",children:"Move to stage..."}),Pe.map(g=>c.jsx("option",{value:g.key,children:g.label},g.key))]}),r&&c.jsx(ve,{variant:"secondary",onClick:d,children:"Apply"})]}),c.jsx("div",{className:"h-5 w-px bg-surface-700"}),c.jsx(ve,{variant:"danger",icon:os,onClick:f,children:"Delete"})]}),h]})}function un(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function Ai({onSaved:e,onCancel:n}){const{saveCompany:t,listCompanies:s}=dt(),{user:r}=jt(),[i,o]=u.useState(!1),[a,l]=u.useState({}),[h,d]=u.useState(""),[f,g]=u.useState({name:"",email:"",phone:"",industry:"",estimatedValue:0});u.useEffect(()=>{if(!f.name.trim()||f.name.trim().length<3){d("");return}const m=setTimeout(async()=>{try{const v=await s(),y=f.name.toLowerCase().trim(),x=v.find(C=>C.name.toLowerCase().includes(y)||y.includes(C.name.toLowerCase()));d(x?`Similar company exists: "${x.name}"`:"")}catch{}},500);return()=>clearTimeout(m)},[f.name,s]);const p=()=>{const m={};return f.name.trim()||(m.name="Company name is required"),f.email&&!un(f.email)&&(m.email="Invalid email format"),l(m),Object.keys(m).length===0},w=async m=>{if(m.preventDefault(),!!p()){o(!0);try{await t({name:f.name,tradingName:f.name,registrationNumber:"",vatNumber:"",industry:f.industry,website:"",address:[],city:"",province:"",postalCode:"",country:"South Africa",phone:f.phone,email:f.email,pipelineStage:"lead",assignedTo:r?.id||"",estimatedValue:f.estimatedValue,creditLimit:0,paymentTerms:30,tags:[],notes:""}),be.success(`Company "${f.name}" created successfully`),e()}catch(v){console.error("Failed to create company:",v),be.error("Failed to create company")}finally{o(!1)}}};return c.jsxs("form",{onSubmit:w,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-1",children:"Company Name *"}),c.jsx("input",{type:"text",value:f.name,onChange:m=>g({...f,name:m.target.value}),onBlur:p,className:`input w-full ${a.name?"border-danger/50":""}`,placeholder:"Enter company name","aria-required":"true",autoFocus:!0}),a.name&&c.jsx("div",{className:"text-xs text-danger mt-1",children:a.name}),h&&c.jsx("div",{className:"text-xs text-warning mt-1",children:h})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-1",children:"Email"}),c.jsx("input",{type:"email",value:f.email,onChange:m=>g({...f,email:m.target.value}),onBlur:()=>{f.email&&!un(f.email)?l(m=>({...m,email:"Invalid email format"})):l(m=>{const{email:v,...y}=m;return y})},className:`input w-full ${a.email?"border-danger/50":""}`,placeholder:"contact@company.com"}),a.email&&c.jsx("div",{className:"text-xs text-danger mt-1",children:a.email})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-1",children:"Phone"}),c.jsx("input",{type:"tel",value:f.phone,onChange:m=>g({...f,phone:m.target.value}),className:"input w-full",placeholder:"+27 XX XXX XXXX"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-1",children:"Industry"}),c.jsx("input",{type:"text",value:f.industry,onChange:m=>g({...f,industry:m.target.value}),className:"input w-full",placeholder:"e.g., Logistics, Manufacturing"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-1",children:"Estimated Value (ZAR)"}),c.jsx("input",{type:"number",value:f.estimatedValue,onChange:m=>g({...f,estimatedValue:parseFloat(m.target.value)||0}),className:"input w-full",placeholder:"0",min:"0",step:"1000"})]}),c.jsxs("div",{className:"flex gap-3 pt-2",children:[c.jsx(ve,{type:"submit",variant:"primary",loading:i,className:"flex-1",children:"Create Company"}),c.jsx(ve,{type:"button",variant:"ghost",onClick:n,disabled:i,children:"Cancel"})]})]})}function Wi(){const[e,n]=u.useState([]),[t,s]=u.useState(!0),[r,i]=u.useState(null),[o,a]=u.useState(!1),[l,h]=u.useState(!1),[d,f]=u.useState(new Set),[g,p]=u.useState({}),{user:w}=jt(),m=ae(S=>S.viewMode),v=ae(S=>S.stageFilters),y=ae(S=>S.searchQuery),x=ae(S=>S.setSearchQuery),{listCompanies:C,searchCompanies:b}=dt(),E=Zn();u.useEffect(()=>{as.users.toArray().then(S=>{const j={};for(const T of S)j[T.id]=T.fullName||T.username;p(j)})},[]),u.useEffect(()=>{E.state?.openNewLead&&(a(!0),window.history.replaceState({},document.title))},[E.state]);const D=u.useCallback(async()=>{s(!0),i(null);try{const S=y.trim()?await b(y):await C();n(S)}catch(S){console.error("Failed to load companies:",S),i("Failed to load companies. Please try again.")}finally{s(!1)}},[y,C,b]);u.useEffect(()=>{D()},[D]);const R=()=>{const S=A.map(O=>({"Company Name":O.name,Industry:O.industry||"","Pipeline Stage":O.pipelineStage,Email:O.email||"",Phone:O.phone||"","Estimated Value":O.estimatedValue||0,Created:O.createdAt?new Date(O.createdAt).toLocaleDateString():""})),j=yt.json_to_sheet(S),T=yt.book_new();yt.book_append_sheet(T,j,"Companies"),es(T,`companies-export-${new Date().toISOString().slice(0,10)}.xlsx`),be.success("Companies exported successfully")},N=v.length===0?e:e.filter(S=>v.includes(S.pipelineStage)),A=l&&w?N.filter(S=>S.assignedTo===w.id):N;return c.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-surface-900 via-surface-800 to-surface-900",children:[c.jsxs(z.div,{className:"max-w-7xl mx-auto p-4 space-y-4",variants:ut,initial:"hidden",animate:"visible",children:[c.jsx(z.div,{variants:oe,children:c.jsx(ls,{})}),c.jsxs(z.div,{variants:oe,className:"flex flex-col sm:flex-row items-start sm:items-center gap-3",children:[c.jsxs("div",{className:"relative flex-1 max-w-md",children:[c.jsx(cs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-500"}),c.jsx("input",{type:"text",placeholder:"Search companies...",value:y,onChange:S=>x(S.target.value),className:"input w-full pl-10 text-sm"})]}),c.jsx(ys,{}),c.jsxs("button",{onClick:()=>h(S=>!S),className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium border transition-colors ${l?"bg-brand-600/30 text-surface-100 border-teal-500/50":"text-surface-100/60 hover:text-surface-100 hover:bg-surface-800/40 border-surface-600/50"}`,children:[c.jsx(us,{className:"w-4 h-4"}),l?"All Accounts":"My Accounts"]}),c.jsx(ve,{variant:"ghost",icon:ds,onClick:R,disabled:A.length===0,children:"Export"}),c.jsx(ve,{variant:"primary",icon:Xt,onClick:()=>a(!0),children:"New Lead"})]}),c.jsx(z.div,{variants:oe,children:c.jsx(ws,{})}),d.size>0&&c.jsx(z.div,{variants:oe,children:c.jsx(Mi,{selectedCount:d.size,selectedIds:d,onClearSelection:()=>f(new Set),onRefresh:D})}),c.jsx(z.div,{variants:oe,children:r?c.jsxs("div",{className:"glass rounded-xl p-8 text-center",children:[c.jsx("div",{className:"text-red-400 text-lg font-semibold mb-2",children:"Failed to load"}),c.jsx("p",{className:"text-surface-400 mb-4",children:r}),c.jsx("button",{onClick:D,className:"btn btn-primary px-6 py-2",children:"Retry"})]}):t?m==="kanban"?c.jsx("div",{className:"grid grid-cols-7 gap-2",children:Array.from({length:7}).map((S,j)=>c.jsxs("div",{className:"space-y-2",children:[c.jsx("div",{className:"h-10 bg-surface-800/40 rounded-t-xl animate-pulse"}),c.jsx("div",{className:"space-y-2 p-2 bg-surface-800/20 rounded-b-xl min-h-[120px]",children:Array.from({length:Math.max(1,3-j)}).map((T,O)=>c.jsx("div",{className:"h-20 bg-surface-700/30 rounded-lg animate-pulse relative overflow-hidden",children:c.jsx("div",{className:"absolute inset-0 animate-shimmer"})},O))})]},j))}):c.jsx("div",{className:"glass rounded-xl overflow-hidden",children:c.jsxs("div",{className:"p-4 space-y-3",children:[c.jsx("div",{className:"h-10 bg-surface-700/50 rounded animate-pulse"}),Array.from({length:5}).map((S,j)=>c.jsx("div",{className:"h-12 bg-surface-700/30 rounded animate-pulse relative overflow-hidden",children:c.jsx("div",{className:"absolute inset-0 animate-shimmer"})},j))]})}):A.length===0?c.jsxs("div",{className:"glass rounded-xl p-12 text-center",children:[c.jsx(gn,{className:"w-12 h-12 text-surface-500 mx-auto mb-4"}),c.jsx("p",{className:"text-surface-400 text-lg font-medium mb-2",children:"No companies found"}),c.jsx("p",{className:"text-surface-500 text-sm mb-6",children:l?"No accounts are assigned to you.":"Try adjusting your search or filters."}),c.jsx(ve,{variant:"primary",icon:Xt,onClick:()=>a(!0),children:"Add your first company"})]}):m==="kanban"?c.jsx(hi,{companies:A,onRefresh:D}):c.jsx(ji,{companies:A,selectedIds:d,onSelectionChange:f,userNameMap:g})})]}),c.jsx(Qn,{children:o&&c.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:S=>S.target===S.currentTarget&&a(!1),onKeyDown:S=>S.key==="Escape"&&a(!1),role:"dialog","aria-modal":"true","aria-labelledby":"new-lead-modal-title",children:c.jsxs(z.div,{initial:{opacity:0,y:100,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:100,scale:.95},transition:{type:"spring",stiffness:300,damping:30},className:"glass rounded-xl p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[c.jsx("h2",{id:"new-lead-modal-title",className:"text-lg font-bold text-surface-100 mb-4",children:"New Lead"}),c.jsx(Ai,{onSaved:()=>{a(!1),D()},onCancel:()=>a(!1)})]})})})]})}export{Wi as default};
