import{j as e,m as S,A as $}from"./vendor-motion-BTi7gxEc.js";import{r as h,f as Ne,u as ye}from"./vendor-react-CUuYCEpB.js";import{c as Ce,W as Se,Y as f,Z as P,_ as B,$ as we,a0 as K,X as de,a1 as W,a2 as X,a as Pe,y as Z,a3 as J,a4 as ee,a5 as ue,T as ke,a6 as Ee,a7 as Re,a8 as xe,t as Q,a9 as Te,n as me,B as Ae,aa as Me,ab as Oe,ac as Fe,ad as Le,ae as Ie,af as De,ag as se,w as G,ah as Be,u as Ue,f as te,l as ae,ai as ne,aj as re,ak as $e}from"./index-BQ8GchdQ.js";import{C as Qe}from"./chevron-left-CrGQCJ_c.js";import{u as he,I,P as fe}from"./useContacts-DXtQf3j4.js";import{P as pe,A as le}from"./plus-Chd8VMT3.js";import"./vendor-zustand-DbidXgKt.js";import"./vendor-dexie-TCJlnc2g.js";import"./vendor-pdf-tjGXvEUX.js";import"./vendor-supabase-DxKkahmj.js";const _e=[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]],ze=Ce("skip-forward",_e),ge=h.createContext(null),je=["Client Info","Settings","Select Units","Configure","Costs","Commercial","Review","Export"],V=je.length;function Ze({children:t}){const[s,l]=h.useState(0),[i,n]=h.useState(null),[a,o]=h.useState("roster"),[p,g]=h.useState("forward"),[r,u]=h.useState(new Set),[d,j]=h.useState(0),[N,c]=h.useState(!1),C=h.useCallback(v=>{g(v>s?"forward":"back"),l(Math.max(0,Math.min(V-1,v)))},[s]),k=h.useCallback(()=>{s<V-1&&(g("forward"),u(v=>new Set(v).add(s)),l(v=>v+1))},[s]),T=h.useCallback(()=>{s>0&&(g("back"),l(v=>v-1))},[s]),E=h.useCallback(v=>{u(y=>new Set(y).add(v))},[]);return e.jsx(ge.Provider,{value:{currentStep:s,activeSlotIndex:i,unitPickerPhase:a,direction:p,completedSteps:r,activeUnitTab:d,goToStep:C,nextStep:k,prevStep:T,markStepCompleted:E,setActiveSlotIndex:n,setUnitPickerPhase:o,setActiveUnitTab:j,canProceed:N,setCanProceed:c,totalSteps:V},children:t})}function M(){const t=h.useContext(ge);if(!t)throw new Error("useBuilder must be used within BuilderProvider");return t}function He(){const{currentStep:t,completedSteps:s,goToStep:l,totalSteps:i}=M(),n=t/(i-1)*100;return e.jsx("div",{className:"glass rounded-xl p-4 mb-4",children:e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsx("div",{className:"absolute left-0 right-0 top-1/2 -translate-y-1/2 h-0.5 bg-surface-700 z-0"}),e.jsx(S.div,{className:"absolute left-0 top-1/2 -translate-y-1/2 h-0.5 bg-brand-500 z-0",initial:{width:"0%"},animate:{width:`${n}%`},transition:{type:"spring",stiffness:300,damping:30}}),je.map((a,o)=>{const p=s.has(o),g=o===t,r=p||o<=t;return e.jsxs("button",{onClick:()=>r&&l(o),disabled:!r,className:"relative z-10 flex flex-col items-center gap-1.5 group",children:[e.jsx(S.div,{className:`
                  w-8 h-8 rounded-full flex items-center justify-center text-xs font-semibold transition-colors
                  ${g?"bg-brand-500 text-white shadow-lg shadow-brand-500/30":p?"bg-brand-500/20 text-brand-400 border border-brand-500/50":"bg-surface-800 text-surface-500 border border-surface-600"}
                  ${r&&!g?"cursor-pointer hover:border-brand-500/50":""}
                  ${r?"":"cursor-not-allowed"}
                `,layout:!0,transition:{type:"spring",stiffness:300,damping:30},children:p?e.jsx(Se,{className:"w-4 h-4"}):o+1}),e.jsx("span",{className:`text-2xs whitespace-nowrap hidden sm:block transition-colors ${g?"text-brand-400 font-semibold":p?"text-surface-400":"text-surface-600"}`,children:a})]},o)})]})})}function qe(){const s=f(l=>l.getQuoteTotals)();return s.unitCount===0?null:e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-surface-400",children:"Units:"}),e.jsx($,{mode:"wait",children:e.jsx(S.span,{initial:{opacity:0,y:-4},animate:{opacity:1,y:0},exit:{opacity:0,y:4},className:"font-semibold text-surface-100",children:s.unitCount},s.unitCount)})]}),e.jsx("div",{className:"h-4 w-px bg-surface-700"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-surface-400",children:"Monthly:"}),e.jsx($,{mode:"wait",children:e.jsx(S.span,{initial:{opacity:0,y:-4},animate:{opacity:1,y:0},exit:{opacity:0,y:4},className:"font-semibold text-brand-400",children:P(s.totalMonthly,!1)},Math.round(s.totalMonthly))})]}),e.jsx("div",{className:"h-4 w-px bg-surface-700 hidden sm:block"}),e.jsxs("div",{className:"items-center gap-1.5 hidden sm:flex",children:[e.jsx("span",{className:"text-surface-400",children:"Contract:"}),e.jsx($,{mode:"wait",children:e.jsx(S.span,{initial:{opacity:0,y:-4},animate:{opacity:1,y:0},exit:{opacity:0,y:4},className:"font-semibold text-surface-100",children:P(s.totalContractValue,!1)},Math.round(s.totalContractValue))})]})]})}const Ve=new Set([3,4]);function We(){const{currentStep:t,nextStep:s,prevStep:l,canProceed:i,totalSteps:n}=M(),a=t===0,o=t===n-1,p=Ve.has(t),g=t===n-2?"Finish":"Next";return e.jsx("div",{className:"glass rounded-xl p-4 mt-4",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[e.jsx(qe,{}),e.jsxs("div",{className:"flex items-center gap-2",children:[!a&&e.jsx(B,{variant:"secondary",icon:Qe,onClick:l,children:"Back"}),p&&e.jsx(B,{variant:"ghost",icon:ze,onClick:s,children:"Skip"}),!o&&e.jsx(B,{variant:"primary",icon:we,onClick:s,disabled:!i,children:g})]})]})})}function Ge({children:t}){return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-surface-900 via-surface-800 to-surface-900",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-6",children:[e.jsx(He,{}),e.jsx("div",{className:"min-h-[60vh]",children:t}),e.jsx(We,{})]})})}const Ke={enter:t=>({x:t==="forward"?80:-80,opacity:0}),center:{x:0,opacity:1},exit:t=>({x:t==="forward"?-80:80,opacity:0})},Xe={type:"spring",stiffness:300,damping:30};function Ye({children:t,stepKey:s}){const{direction:l}=M();return e.jsx($,{mode:"wait",custom:l,children:e.jsx(S.div,{custom:l,variants:Ke,initial:"enter",animate:"center",exit:"exit",transition:Xe,className:"w-full",children:t},s)})}function A({title:t,subtitle:s,step:l}){return e.jsxs(S.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.3,delay:.1},className:"mb-6",children:[e.jsx("div",{className:"flex items-center gap-3 mb-1",children:e.jsxs("span",{className:"text-xs font-semibold text-brand-500 bg-brand-500/10 rounded-full px-2.5 py-0.5",children:["Step ",l+1]})}),e.jsx("h2",{className:"text-2xl font-bold text-surface-100",children:t}),s&&e.jsx("p",{className:"text-sm text-surface-400 mt-1",children:s})]})}function Je({isOpen:t,onClose:s,onSelect:l,onSkip:i}){const[n,a]=h.useState(""),[o,p]=h.useState([]),[g,r]=h.useState(!1),{searchCompanies:u,listCompanies:d}=K(),{getPrimary:j}=he();h.useEffect(()=>{if(!t)return;const C=setTimeout(async()=>{r(!0);const k=n.trim()?await u(n):await d();p(k),r(!1)},200);return()=>clearTimeout(C)},[n,t]);const N=async c=>{const C=await j(c.id);l(c,C)};return t?e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"company-picker-modal-title",onKeyDown:c=>c.key==="Escape"&&s(),children:e.jsxs("div",{className:"glass rounded-xl w-full max-w-lg max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-surface-700/50",children:[e.jsx("h2",{id:"company-picker-modal-title",className:"text-lg font-bold text-surface-100",children:"Link to Company"}),e.jsx("button",{onClick:s,className:"text-surface-400 hover:text-surface-200 transition-colors",children:e.jsx(de,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-500"}),e.jsx("input",{type:"text",placeholder:"Search companies by name...",value:n,onChange:c=>a(c.target.value),className:"input w-full pl-10 text-sm",autoFocus:!0})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 pb-2",children:g?e.jsx("div",{className:"text-center text-surface-500 py-6",children:"Searching..."}):o.length===0?e.jsx("div",{className:"text-center text-surface-500 py-6",children:"No companies found"}):e.jsx("div",{className:"space-y-1",children:o.map(c=>e.jsxs("button",{onClick:()=>N(c),className:"w-full flex items-center gap-3 p-3 rounded-lg hover:bg-surface-700/50 transition-colors text-left",children:[e.jsx("div",{className:"p-2 bg-brand-500/20 rounded-lg flex-shrink-0",children:e.jsx(X,{className:"w-4 h-4 text-brand-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-surface-100 truncate",children:c.name}),e.jsx("div",{className:"text-xs text-surface-400 truncate",children:[c.city,c.province].filter(Boolean).join(", ")||"No address"})]})]},c.id))})}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-surface-700/50",children:[e.jsx(B,{variant:"ghost",onClick:i,children:"Skip (no company)"}),e.jsx(B,{variant:"ghost",icon:pe,onClick:()=>{s()},children:"Create New"})]})]})}):null}function es({value:t,onChange:s,onSelect:l,onClear:i,linkedCompanyId:n,label:a="Client / Company Name *",placeholder:o="e.g. Adcock Ingram",onOpenChange:p}){const[g,r]=h.useState(!1),[u,d]=h.useState([]),[j,N]=h.useState(-1),[c,C]=h.useState({top:0,left:0,width:0}),k=h.useRef(null),T=h.useRef(null),E=h.useRef(0),{searchCompanies:v}=K();h.useEffect(()=>{p?.(g)},[g,p]);const y=h.useCallback(()=>{if(!k.current)return;const b=k.current.getBoundingClientRect();C({top:b.bottom+4,left:b.left,width:b.width})},[]);h.useEffect(()=>{if(t.length<2){d([]),r(!1);return}const b=++E.current,R=setTimeout(async()=>{const F=await v(t);b===E.current&&(d(F),r(F.length>0),N(-1),y())},300);return()=>clearTimeout(R)},[t,v,y]),h.useEffect(()=>{if(!g)return;function b(R){const F=R.target;k.current&&!k.current.contains(F)&&T.current&&!T.current.contains(F)&&r(!1)}return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[g]),h.useEffect(()=>{if(g)return y(),window.addEventListener("scroll",y,!0),window.addEventListener("resize",y),()=>{window.removeEventListener("scroll",y,!0),window.removeEventListener("resize",y)}},[g,y]);const D=b=>{const R=b.target.value;s(R),n&&i()},O=b=>{l(b),r(!1),d([])},U=b=>{if(g){if(b.key==="Escape"){r(!1);return}if(b.key==="ArrowDown"){b.preventDefault(),N(R=>Math.min(R+1,u.length-1));return}if(b.key==="ArrowUp"){b.preventDefault(),N(R=>Math.max(R-1,0));return}b.key==="Enter"&&j>=0&&j<u.length&&(b.preventDefault(),O(u[j]))}};return e.jsxs("div",{className:"relative",children:[a&&e.jsx("label",{className:"block text-sm font-medium text-surface-300 mb-1",children:a}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:k,type:"text",value:t,onChange:D,onKeyDown:U,onFocus:()=>{u.length>0&&(y(),r(!0))},placeholder:o,className:`input w-full text-sm ${n?"pr-20":""}`}),n&&e.jsxs("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1 px-2 py-0.5 rounded-full bg-brand-500/20 text-brand-400 text-[10px] font-semibold",children:[e.jsx(X,{className:"w-3 h-3"}),"Linked",e.jsx("button",{type:"button",onClick:i,className:"ml-0.5 hover:text-brand-200 transition-colors",children:e.jsx(de,{className:"w-3 h-3"})})]})]}),g&&u.length>0&&Ne.createPortal(e.jsx("div",{ref:T,style:{position:"fixed",top:c.top,left:c.left,width:c.width,zIndex:9999},className:"bg-surface-800 border border-surface-600 rounded-lg shadow-2xl overflow-hidden",children:e.jsx("div",{className:"max-h-52 overflow-y-auto",children:u.map((b,R)=>e.jsxs("button",{type:"button",onClick:()=>O(b),className:`w-full text-left px-3 py-2 text-xs transition-colors ${R===j?"bg-brand-500/20 text-brand-300":"text-surface-200 hover:bg-surface-700/50"}`,children:[e.jsxs("div",{className:"font-medium truncate",children:[b.name,b.tradingName&&b.tradingName!==b.name&&e.jsxs("span",{className:"text-surface-400 font-normal ml-1",children:["(",b.tradingName,")"]})]}),b.city&&e.jsx("div",{className:"text-[10px] text-surface-500 truncate",children:b.city})]},b.id))})}),document.body)]})}function ss({companyId:t,onSelect:s,onManual:l}){const[i,n]=h.useState([]),[a,o]=h.useState(!1),[p,g]=h.useState(""),{getByCompany:r}=he();if(h.useEffect(()=>{let d=!1;return o(!0),g(""),r(t).then(j=>{if(d)return;const N=[...j].sort((c,C)=>c.isPrimary&&!C.isPrimary?-1:!c.isPrimary&&C.isPrimary?1:c.lastName.localeCompare(C.lastName));n(N),o(!1)}),()=>{d=!0}},[t,r]),a)return e.jsx("div",{className:"text-xs text-surface-500 py-1",children:"Loading contacts..."});if(i.length===0)return null;const u=d=>{const j=d.target.value;if(g(j),j==="__manual__"){l();return}const N=i.find(c=>c.id===j);N&&s(N)};return e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"flex items-center gap-1.5 text-sm font-medium text-surface-300 mb-1",children:[e.jsx(Pe,{className:"w-3.5 h-3.5"}),"Pick a Contact"]}),e.jsxs("select",{value:p,onChange:u,className:"input w-full text-sm",children:[e.jsx("option",{value:"",children:"-- Select a contact --"}),i.map(d=>e.jsxs("option",{value:d.id,children:[d.firstName," ",d.lastName,d.title?` — ${d.title}`:"",d.isPrimary?" (Primary)":"",d.email?` · ${d.email}`:""]},d.id)),e.jsx("option",{value:"__manual__",children:"Enter manually"})]})]})}const ts=/\b(pty|ltd|inc|cc|llc|co|corp|company|group)\b|\(pty\)|\(ltd\)/gi;function ie(t){return t.toLowerCase().replace(ts,"").replace(/[^a-z0-9]/g,"").trim()}function as(t,s){const l=t.length,i=s.length,n=Array.from({length:l+1},()=>Array(i+1).fill(0));for(let a=0;a<=l;a++)n[a][0]=a;for(let a=0;a<=i;a++)n[0][a]=a;for(let a=1;a<=l;a++)for(let o=1;o<=i;o++)n[a][o]=t[a-1]===s[o-1]?n[a-1][o-1]:1+Math.min(n[a-1][o],n[a][o-1],n[a-1][o-1]);return n[l][i]}function ce(t,s){const l=ie(t),i=ie(s);if(!l||!i)return!1;if(l===i)return!0;if(l.length<4||i.length<4)return!1;if(l.includes(i)||i.includes(l))return!0;const n=as(l,i),a=Math.max(l.length,i.length);return 1-n/a>=.75}function ns(){const t=f(m=>m.clientName),s=f(m=>m.contactName),l=f(m=>m.contactTitle),i=f(m=>m.contactEmail),n=f(m=>m.contactPhone),a=f(m=>m.clientAddress),o=f(m=>m.companyId),p=f(m=>m.setCustomerField),g=f(m=>m.setCustomerInfo),[r,u]=h.useState(!1),[d,j]=h.useState(null),[N,c]=h.useState(!1),[C,k]=h.useState(!1),{setCanProceed:T}=M(),{searchCompanies:E}=K(),v=h.useRef(0),y=(m,L)=>{g({companyId:m.id,clientName:m.name,clientAddress:[m.address?.[0]||"",m.city||"",m.province||"",m.postalCode||""],...L&&{contactName:`${L.firstName} ${L.lastName}`.trim(),contactTitle:L.title||"",contactEmail:L.email||"",contactPhone:L.phone||""}}),u(!1),j(null),c(!1)},D=m=>{g({companyId:m.id,clientName:m.name,clientAddress:[m.address?.[0]||"",m.city||"",m.province||"",m.postalCode||""]}),j(null),c(!1)},O=()=>{p("companyId",void 0)},U=m=>{g({contactName:`${m.firstName} ${m.lastName}`.trim(),contactTitle:m.title||"",contactEmail:m.email||"",contactPhone:m.phone||""})},b=()=>{g({contactName:"",contactTitle:"",contactEmail:"",contactPhone:""})},R=async()=>{d&&D(d)};h.useEffect(()=>{T(t.trim().length>0&&s.trim().length>0)},[t,s,T]),h.useEffect(()=>{if(o||t.trim().length<3||N){j(null);return}const m=++v.current,L=setTimeout(async()=>{const _=await E(t);if(m!==v.current)return;const x=_.find(w=>ce(t,w.name)||w.tradingName&&ce(t,w.tradingName));j(x||null)},500);return()=>clearTimeout(L)},[t,o,N,E]);const F=(m,L)=>{const _=[...a];_[m]=L,p("clientAddress",_)};return e.jsxs("div",{className:"glass rounded-xl p-6",children:[e.jsx(A,{step:0,title:"Client Information",subtitle:"Enter the client and contact details for this quote."}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-surface-300",children:"Company"}),e.jsx(B,{variant:"ghost",icon:X,onClick:()=>u(!0),children:o?"Change Company":"Link Company"})]}),e.jsx(es,{value:t,onChange:m=>p("clientName",m),onSelect:D,onClear:O,linkedCompanyId:o,onOpenChange:k}),d&&!o&&!C&&e.jsxs("div",{className:"mt-3 flex items-start gap-3 p-3 rounded-lg bg-amber-500/10 border border-amber-500/30",children:[e.jsx(Z,{className:"w-4 h-4 text-amber-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-xs text-amber-200",children:["A company called ",e.jsxs("span",{className:"font-semibold",children:['"',d.name,'"']})," already exists."]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{type:"button",onClick:R,className:"px-2.5 py-1 text-[11px] font-medium rounded bg-amber-500/20 text-amber-300 hover:bg-amber-500/30 transition-colors",children:"Link to it"}),e.jsx("button",{type:"button",onClick:()=>{c(!0),j(null)},className:"px-2.5 py-1 text-[11px] font-medium rounded text-surface-400 hover:text-surface-200 transition-colors",children:"Dismiss"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-surface-300 mb-3",children:"Contact Person"}),o&&e.jsx(ss,{companyId:o,onSelect:U,onManual:b}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(I,{label:"Contact Name *",placeholder:"e.g. John Smith",value:s,onChange:m=>p("contactName",m.target.value)}),e.jsx(I,{label:"Title",placeholder:"e.g. Warehouse Manager",value:l,onChange:m=>p("contactTitle",m.target.value)}),e.jsx(I,{label:"Email",type:"email",placeholder:"john@company.co.za",value:i,onChange:m=>p("contactEmail",m.target.value)}),e.jsx(I,{label:"Phone",type:"tel",placeholder:"+27 72 839 9058",value:n,onChange:m=>p("contactPhone",m.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-surface-300 mb-3",children:"Address"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(I,{label:"Address Line 1",placeholder:"Street address",value:a[0]||"",onChange:m=>F(0,m.target.value)}),e.jsx(I,{label:"Address Line 2",placeholder:"Suburb / area",value:a[1]||"",onChange:m=>F(1,m.target.value)}),e.jsx(I,{label:"City",placeholder:"City",value:a[2]||"",onChange:m=>F(2,m.target.value)}),e.jsx(I,{label:"Postal Code",placeholder:"Postal code",value:a[3]||"",onChange:m=>F(3,m.target.value)})]})]})]}),e.jsx(Je,{isOpen:r,onClose:()=>u(!1),onSelect:y,onSkip:()=>u(!1)})]})}const rs=[36,48,60,72,84],ls=[{value:"rental",label:"Rental",description:"Monthly rental payments"},{value:"rent-to-own",label:"Rent-to-Own",description:"Ownership transfers at end of term"},{value:"dual",label:"Dual",description:"Both rental and rent-to-own options"}];function is(){const t=f(c=>c.factoryROE),s=f(c=>c.customerROE),l=f(c=>c.discountPct),i=f(c=>c.annualInterestRate),n=f(c=>c.defaultLeaseTermMonths),a=f(c=>c.quoteType),o=f(c=>c.setFactoryROE),p=f(c=>c.setCustomerROE),g=f(c=>c.setDiscount),r=f(c=>c.setInterestRate),u=f(c=>c.setDefaultLeaseTermMonths),d=f(c=>c.setQuoteType),{setCanProceed:j}=M(),N=s>0&&t>0&&s<t;return h.useEffect(()=>{j(!0)},[j]),e.jsxs("div",{className:"glass rounded-xl p-6",children:[e.jsx(A,{step:1,title:"Quote Settings",subtitle:"Configure exchange rates, discount, interest rate, and default terms."}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-surface-300 mb-3 flex items-center gap-2",children:["Exchange Rates",e.jsx(J,{content:"Factory ROE is used to convert EUR costs to ZAR. Customer ROE can be different to build in margin.",children:e.jsx(ee,{className:"w-3.5 h-3.5 text-surface-500 cursor-help"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(I,{label:"Factory ROE (EUR → ZAR)",type:"number",step:"0.01",min:"0",value:t||"",onChange:c=>o(parseFloat(c.target.value)||0)}),e.jsx(I,{label:"Customer ROE (EUR → ZAR)",type:"number",step:"0.01",min:"0",value:s||"",onChange:c=>p(parseFloat(c.target.value)||0),error:N?"Customer ROE should not be lower than Factory ROE":void 0})]}),N&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-warning bg-warning/10 rounded-lg p-2.5",children:[e.jsx(Z,{className:"w-4 h-4 flex-shrink-0"}),e.jsxs("span",{children:["Customer ROE (",s,") is below Factory ROE (",t,"). This will reduce margins."]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-surface-300 mb-3",children:"Pricing Parameters"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(I,{label:"Discount %",type:"number",step:"0.5",min:"0",max:"100",value:l||"",onChange:c=>g(parseFloat(c.target.value)||0)}),e.jsx(I,{label:"Annual Interest Rate %",type:"number",step:"0.25",min:"0",max:"100",value:i||"",onChange:c=>r(parseFloat(c.target.value)||0)})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-surface-300 mb-3 flex items-center gap-2",children:["Default Lease Term",e.jsx(J,{content:"Default term applied to new units. Can be overridden per unit in the Commercial step.",children:e.jsx(ee,{className:"w-3.5 h-3.5 text-surface-500 cursor-help"})})]}),e.jsx("div",{className:"flex gap-2",children:rs.map(c=>e.jsxs("button",{onClick:()=>u(c),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${n===c?"bg-brand-500 text-white shadow-lg shadow-brand-500/20":"bg-surface-800 text-surface-300 hover:bg-surface-700 border border-surface-600"}`,children:[c," mo"]},c))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-surface-300 mb-3",children:"Quote Type"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:ls.map(({value:c,label:C,description:k})=>e.jsxs("button",{onClick:()=>d(c),className:`text-left p-4 rounded-lg border transition-all ${a===c?"bg-brand-500/10 border-brand-500/50 shadow-lg shadow-brand-500/5":"bg-surface-800/50 border-surface-600 hover:border-surface-500"}`,children:[e.jsx("div",{className:`text-sm font-semibold ${a===c?"text-brand-400":"text-surface-200"}`,children:C}),e.jsx("div",{className:"text-xs text-surface-400 mt-0.5",children:k})]},c))})]})]})]})}function cs({slotIndex:t,onEdit:s,onRemove:l}){const i=f(p=>p.slots[t]),n=f(p=>p.factoryROE),o=f(p=>p.getSlotPricing)(t);return i.isEmpty?null:e.jsxs(S.div,{layout:!0,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"glass rounded-xl p-4 border border-brand-500/20",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand-500/10 flex items-center justify-center",children:e.jsx(ue,{className:"w-5 h-5 text-brand-500"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-surface-100",children:i.modelName||"Unknown Model"}),e.jsx("div",{className:"text-xs text-surface-400",children:i.seriesCode?`Series ${i.seriesCode.slice(0,4)}`:""})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:s,className:"p-1.5 rounded-lg hover:bg-surface-700/50 text-surface-400 hover:text-brand-400 transition-colors",children:e.jsx(fe,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:l,className:"p-1.5 rounded-lg hover:bg-surface-700/50 text-surface-400 hover:text-danger transition-colors",children:e.jsx(ke,{className:"w-3.5 h-3.5"})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Qty"}),e.jsx("div",{className:"font-semibold text-surface-200",children:i.quantity})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Base Price"}),e.jsx("div",{className:"font-mono text-surface-200",children:P(i.eurCost*n,!1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Monthly"}),e.jsx("div",{className:"font-mono text-brand-400",children:o?P(o.totalMonthly,!1):"--"})]})]})]})}function os({seriesCode:t,seriesName:s,modelCount:l,onClick:i}){return e.jsx(S.button,{onClick:i,className:"text-left w-full glass rounded-xl p-5 border border-surface-600 hover:border-brand-500/50 transition-colors group",whileHover:{scale:1.02},whileTap:{scale:.98},layout:!0,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand-500/10 flex items-center justify-center flex-shrink-0",children:e.jsx(Ee,{className:"w-5 h-5 text-brand-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold text-surface-100 group-hover:text-brand-400 transition-colors truncate",children:s}),e.jsxs("div",{className:"text-xs text-surface-500 mt-0.5",children:[l," model",l!==1?"s":""," available"]})]})]})})}function ds({modelName:t,baseEurCost:s,factoryROE:l,onClick:i}){const n=s*l;return e.jsx(S.button,{onClick:i,className:"text-left w-full glass rounded-xl p-5 border border-surface-600 hover:border-feature-500/50 transition-colors group",whileHover:{scale:1.02},whileTap:{scale:.98},layout:!0,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-feature-500/10 flex items-center justify-center flex-shrink-0",children:e.jsx(ue,{className:"w-5 h-5 text-feature-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold text-surface-100 group-hover:text-feature-400 transition-colors",children:t}),e.jsxs("div",{className:"text-xs text-surface-400 mt-1 font-mono",children:["Base: ",P(n,!1)]})]})]})})}function us(){const t=f(x=>x.slots),s=f(x=>x.selectSeries),l=f(x=>x.selectModel),i=f(x=>x.toggleOption),n=f(x=>x.clearSlot),a=f(x=>x.updateSlot),o=f(x=>x.factoryROE),{setCanProceed:p,activeSlotIndex:g,setActiveSlotIndex:r,unitPickerPhase:u,setUnitPickerPhase:d}=M(),[j,N]=h.useState(""),[c,C]=h.useState(""),[k,T]=h.useState(1),E=t.filter(x=>!x.isEmpty&&x.modelCode!=="0"),v=Re(),y=xe(c);h.useEffect(()=>{p(E.length>0)},[E.length,p]);const D=h.useMemo(()=>{if(!j)return v;const x=j.toLowerCase();return v.filter(w=>w.seriesName.toLowerCase().includes(x)||w.seriesCode.includes(j))},[v,j]),O=h.useMemo(()=>{if(!y)return[];if(!j)return y.models;const x=j.toLowerCase();return y.models.filter(w=>w.modelName.toLowerCase().includes(x))},[y,j]),U=()=>{for(let x=0;x<6;x++)if(t[x].isEmpty)return x;return null},b=()=>{const x=U();x!==null&&(r(x),d("series"),N(""),C(""),T(1))},R=x=>{C(x),g!==null&&s(g,x),d("model"),N("")},F=x=>{if(g===null||!y)return;const w=y.models.find(q=>q.materialNumber===x);if(!w)return;const H=g;l(H,w.materialNumber,w.modelName,w.baseEurCost,w.indxColumn),a(H,{quantity:k});const ve=Te(y.options,w.indxColumn,y.models);Object.entries(ve).forEach(([q,be])=>{i(H,q,be)}),r(null),d("roster"),N("")},m=()=>{u==="model"?(d("series"),C(""),N("")):u==="series"&&(g!==null&&n(g),r(null),d("roster"),N(""))},L=x=>{r(x),C(t[x].seriesCode),d("series"),N("")},_=x=>{n(x),Q.success("Unit removed")};return u==="roster"?e.jsxs("div",{className:"glass rounded-xl p-6",children:[e.jsx(A,{step:2,title:"Select Units",subtitle:`Add up to 6 units to your quote. ${E.length} configured so far.`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-4",children:[e.jsx($,{mode:"popLayout",children:E.map(x=>e.jsx(cs,{slotIndex:x.slotIndex,onEdit:()=>L(x.slotIndex),onRemove:()=>_(x.slotIndex)},x.slotIndex))}),E.length<6&&e.jsxs(S.button,{onClick:b,className:"glass rounded-xl p-6 border-2 border-dashed border-surface-600 hover:border-brand-500/50 flex flex-col items-center justify-center gap-2 transition-colors min-h-[120px]",whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx(pe,{className:"w-6 h-6 text-surface-500"}),e.jsx("span",{className:"text-sm text-surface-400",children:"Add Unit"})]})]})]}):u==="series"?e.jsxs("div",{className:"glass rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("button",{onClick:m,className:"p-2 rounded-lg hover:bg-surface-700/50 text-surface-400 hover:text-surface-100 transition-colors",children:e.jsx(le,{className:"w-5 h-5"})}),e.jsx(A,{step:2,title:"Choose Series",subtitle:"Select a forklift series to see available models."})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(W,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-500"}),e.jsx("input",{type:"text",placeholder:"Search series...",value:j,onChange:x=>N(x.target.value),className:"input w-full pl-10 text-sm"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:D.map((x,w)=>e.jsx(S.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:w*.05},children:e.jsx(os,{seriesCode:x.seriesCode,seriesName:x.seriesName,modelCount:x.modelCount,onClick:()=>R(x.seriesCode)})},x.seriesCode))}),D.length===0&&e.jsxs("div",{className:"text-center py-8 text-surface-500",children:['No series found matching "',j,'"']})]}):e.jsxs("div",{className:"glass rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("button",{onClick:m,className:"p-2 rounded-lg hover:bg-surface-700/50 text-surface-400 hover:text-surface-100 transition-colors",children:e.jsx(le,{className:"w-5 h-5"})}),e.jsx(A,{step:2,title:"Choose Model",subtitle:y?`${y.seriesName} — select a model`:"Select a model"})]}),e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsx("label",{className:"text-sm text-surface-400",children:"Quantity:"}),e.jsx("input",{type:"number",min:"1",max:"99",value:k,onChange:x=>T(Math.max(1,Math.min(99,parseInt(x.target.value)||1))),className:"input w-20 text-sm text-center"})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(W,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-surface-500"}),e.jsx("input",{type:"text",placeholder:"Search models...",value:j,onChange:x=>N(x.target.value),className:"input w-full pl-10 text-sm"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:O.map((x,w)=>e.jsx(S.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:w*.05},children:e.jsx(ds,{modelName:x.modelName,materialNumber:x.materialNumber,baseEurCost:x.baseEurCost,factoryROE:o,onClick:()=>F(x.materialNumber)})},x.materialNumber))}),O.length===0&&e.jsx("div",{className:"text-center py-8 text-surface-500",children:y?"No models found":"Loading models..."})]})}function Y(){const t=f(n=>n.slots),{activeUnitTab:s,setActiveUnitTab:l}=M(),i=t.filter(n=>!n.isEmpty&&n.modelCode!=="0");return i.length<=1?null:e.jsx("div",{className:"flex gap-1 mb-4 bg-surface-800/50 rounded-lg p-1 overflow-x-auto",children:i.map((n,a)=>e.jsxs("button",{onClick:()=>l(a),className:`relative px-4 py-2 rounded-md text-sm font-medium whitespace-nowrap transition-colors ${s===a?"text-brand-400":"text-surface-400 hover:text-surface-200"}`,children:[s===a&&e.jsx(S.div,{layoutId:"activeUnitTab",className:"absolute inset-0 bg-surface-700/50 rounded-md",transition:{type:"spring",stiffness:300,damping:30}}),e.jsxs("span",{className:"relative z-10",children:["Unit ",a+1,": ",n.modelName]})]},n.slotIndex))})}function xs({title:t,count:s,defaultOpen:l=!1,children:i}){const[n,a]=h.useState(l);return e.jsxs("div",{className:"border border-surface-700/50 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>a(!n),className:"w-full flex items-center justify-between px-4 py-3 bg-surface-800/30 hover:bg-surface-800/50 transition-colors",children:[e.jsx("span",{className:"text-sm font-semibold text-surface-300",children:t}),e.jsxs("div",{className:"flex items-center gap-2",children:[s!==void 0&&e.jsxs("span",{className:"text-xs text-surface-500",children:[s," options"]}),e.jsx(S.div,{animate:{rotate:n?180:0},transition:{duration:.2},children:e.jsx(me,{className:"w-4 h-4 text-surface-500"})})]})]}),e.jsx($,{initial:!1,children:n&&e.jsx(S.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2,ease:"easeInOut"},children:e.jsx("div",{className:"px-4 py-2 space-y-1",children:i})})})]})}function ms(t){switch(t){case 1:return{label:"Standard",variant:"success"};case 2:return{label:"Optional",variant:"info"};case 3:return{label:"Non-Standard",variant:"warning"};default:return{label:"N/A",variant:"danger"}}}function hs({description:t,isSelected:s,isStandard:l,availabilityLevel:i,eurPrice:n,factoryROE:a,onToggle:o,delay:p=0,notes:g}){const r=ms(i),u=n*a;return e.jsxs(S.label,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:p},className:`flex items-start gap-3 py-2 px-2 rounded-lg cursor-pointer transition-colors ${s?"bg-brand-500/5":"hover:bg-surface-800/30"} ${l?"opacity-70":""}`,children:[e.jsx("input",{type:"checkbox",checked:s,onChange:o,disabled:l,className:"w-4 h-4 mt-0.5 rounded border-surface-600 bg-surface-800 text-brand-500 focus:ring-brand-500/50 disabled:opacity-50 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm text-surface-300 truncate block",children:t}),g&&e.jsx("span",{className:"text-xs text-surface-500 italic block mt-0.5",children:g})]}),e.jsx(Ae,{variant:r.variant,className:"text-2xs flex-shrink-0",children:r.label}),i>=2&&n>0&&e.jsxs("span",{className:"text-xs font-mono text-brand-400 flex-shrink-0",children:["+",P(u,!1)]}),i===3&&e.jsx(Z,{className:"w-3.5 h-3.5 text-warning flex-shrink-0"})]})}function fs(t){const s=parseInt(t,10);return s>=1100&&s<1200?"Basic":s>=1200&&s<1400?"Pedals & Brakes":s>=1300&&s<1400||s>=1400&&s<2e3?"Wheels & Tires":s>=2e3&&s<2300?"Battery Compartment":s>=2300&&s<3e3?"Axle":s>=3e3&&s<3500?"Mast":s>=3500&&s<4e3?"Forks & Hydraulics":s>=4e3&&s<5e3?"Controls & Safety":s>=5e3&&s<6e3?"Cabin & Comfort":s>=6e3&&s<7e3?"Electrical":s>=7e3&&s<8e3?"Forks":"Other"}function ps({slotIndex:t}){const s=f(r=>r.slots[t]),l=f(r=>r.factoryROE),i=f(r=>r.toggleOption),n=f(r=>r.updateSlot),a=xe(s.seriesCode),o=Me(s.seriesCode,s.indxColumn),p=h.useMemo(()=>{if(!o.length)return{};const r={};return o.forEach(u=>{if(u.specCode==="1100")return;const d=fs(u.specCode);r[d]||(r[d]=[]),r[d].push(u)}),r},[o]);h.useEffect(()=>{if(!a||!s.indxColumn)return;const r=Oe(s.configuration,a.options,s.indxColumn,a.models);r!==s.configurationCost&&n(t,{configurationCost:r})},[s.configuration,s.indxColumn,a]);const g=(s.configurationCost||0)*l;return e.jsxs("div",{children:[g>0&&e.jsxs("div",{className:"mb-4 p-3 rounded-lg bg-brand-500/5 border border-brand-500/20",children:[e.jsx("span",{className:"text-sm text-surface-400",children:"Configuration cost: "}),e.jsx("span",{className:"text-sm font-semibold font-mono text-brand-400",children:P(g,!1)})]}),e.jsx("div",{className:"space-y-2",children:Object.entries(p).map(([r,u])=>e.jsx(xs,{title:r,count:u.length,defaultOpen:r==="Basic",children:u.map((d,j)=>{if(!a)return null;const N=Fe(d,s.indxColumn,a.models);if(N===0)return null;const c=s.configuration[d.specCode]===d.materialNumber,C=N===1;return e.jsx(hs,{description:d.description,isSelected:c,isStandard:C,availabilityLevel:N,eurPrice:d.eurPrice,factoryROE:l,onToggle:()=>i(t,d.specCode,d.materialNumber),delay:j*.03,notes:d.notes},d.materialNumber)})},r))}),Object.keys(p).length===0&&e.jsx("div",{className:"text-center py-8 text-surface-500",children:"No configuration options available for this model."})]})}function gs(){const t=f(a=>a.slots),{setCanProceed:s,activeUnitTab:l}=M(),i=t.filter(a=>!a.isEmpty&&a.modelCode!=="0");if(h.useEffect(()=>{s(!0)},[s]),i.length===0)return e.jsx("div",{className:"glass rounded-xl p-6",children:e.jsx(A,{step:3,title:"Configure Options",subtitle:"No units to configure. Go back to add units first."})});const n=i[Math.min(l,i.length-1)];return e.jsxs("div",{className:"glass rounded-xl p-6",children:[e.jsx(A,{step:3,title:"Configure Options",subtitle:"Customize configuration options for each unit. Standard options are pre-selected."}),e.jsx(Y,{}),e.jsx(ps,{slotIndex:n.slotIndex})]})}function oe({title:t,fields:s,collapsible:l=!1,defaultOpen:i=!0}){const[n,a]=h.useState(i),o=e.jsx("div",{className:"space-y-2",children:s.map(p=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-sm text-surface-400 w-40 flex-shrink-0",children:p.label}),e.jsxs("div",{className:"flex items-center gap-1 flex-1",children:[e.jsx("span",{className:"text-xs text-surface-500",children:"R"}),e.jsx("input",{type:"number",min:"0",step:p.step||100,value:p.value||"",onChange:g=>p.onChange(parseFloat(g.target.value)||0),placeholder:"0",className:"input w-full text-sm"})]})]},p.key))});return l?e.jsxs("div",{className:"border border-surface-700/30 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>a(!n),className:"w-full flex items-center justify-between px-4 py-2.5 bg-surface-800/20 hover:bg-surface-800/40 transition-colors",children:[e.jsx("span",{className:"text-xs font-bold text-surface-500 uppercase",children:t}),e.jsx(S.div,{animate:{rotate:n?180:0},transition:{duration:.2},children:e.jsx(me,{className:"w-4 h-4 text-surface-500"})})]}),e.jsx($,{initial:!1,children:n&&e.jsx(S.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},children:e.jsx("div",{className:"p-4",children:o})})})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-xs font-bold text-surface-500 uppercase",children:t}),o]})}function js({slotIndex:t}){const s=f(r=>r.slots[t]),l=f(r=>r.setLocalBatteryCost),i=f(r=>r.selectTelematicsPackage),n=f(r=>r.updateSlot),a=f(r=>r.setClearingCharge),o=f(r=>r.setLocalCost),p=Le(),g=r=>{if(!r){i(t,"",0);return}const u=p.find(d=>d.id===r);u&&i(t,u.id,u.costZAR)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-xs font-bold text-surface-500 uppercase",children:"Local Battery"}),e.jsx("input",{type:"text",placeholder:"Battery description (e.g. 48V 700Ah Lead-Acid)",value:s.localBatteryDescription,onChange:r=>l(t,s.localBatteryCostZAR,r.target.value),className:"input w-full text-sm"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs text-surface-500",children:"R"}),e.jsx("input",{type:"number",min:"0",step:"500",value:s.localBatteryCostZAR||"",onChange:r=>l(t,parseFloat(r.target.value)||0,s.localBatteryDescription),placeholder:"0",className:"input w-full text-sm"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-xs font-bold text-surface-500 uppercase",children:"Telematics Package"}),e.jsx(Ie,{value:s.telematicsPackageId,onChange:g,placeholder:"None selected",options:p.map(r=>({value:r.id,label:`${r.name} (R${r.costZAR.toLocaleString()})`}))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-xs font-bold text-surface-500 uppercase",children:"Local Attachment Cost"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs text-surface-500",children:"R"}),e.jsx("input",{type:"number",min:"0",step:"500",value:s.localAttachmentCostZAR||"",onChange:r=>n(t,{localAttachmentCostZAR:parseFloat(r.target.value)||0}),placeholder:"0",className:"input w-full text-sm"})]})]}),e.jsx(oe,{title:"Clearing Charges",collapsible:!0,defaultOpen:!1,fields:[["inlandFreight","Inland Freight"],["seaFreight","Sea Freight"],["portCharges","Port Charges"],["transport","Transport"],["destuffing","Destuffing"],["duties","Duties"],["warranty","Warranty"]].map(([r,u])=>({key:r,label:u,value:s.clearingCharges[r],onChange:d=>a(t,r,d)}))}),e.jsx(oe,{title:"Local Costs",collapsible:!0,defaultOpen:!1,fields:[["assembly","Assembly"],["loadTest","Load Test"],["delivery","Delivery"],["pdi","PDI"],["extras","Extras"]].map(([r,u])=>({key:r,label:u,value:s.localCosts[r],onChange:d=>o(t,r,d)}))})]})}function vs(){const t=f(a=>a.slots),{setCanProceed:s,activeUnitTab:l}=M(),i=t.filter(a=>!a.isEmpty&&a.modelCode!=="0");if(h.useEffect(()=>{s(!0)},[s]),i.length===0)return e.jsx("div",{className:"glass rounded-xl p-6",children:e.jsx(A,{step:4,title:"Costs",subtitle:"No units to configure costs for."})});const n=i[Math.min(l,i.length-1)];return e.jsxs("div",{className:"glass rounded-xl p-6",children:[e.jsx(A,{step:4,title:"Costs",subtitle:"Add battery, telematics, clearing charges, and local costs. All fields are optional."}),e.jsx(Y,{}),e.jsx(js,{slotIndex:n.slotIndex})]})}function bs({slotIndex:t}){const l=f(n=>n.getSlotPricing)(t);if(!l)return null;const i=[{label:"Landed Cost",value:l.landedCostZAR,color:"text-surface-200"},{label:"Selling Price",value:l.sellingPriceZAR,color:"text-brand-400"},{label:"Margin",value:l.margin,color:l.margin>=25?"text-green-400":l.margin>=15?"text-yellow-400":"text-red-400",isPercent:!0},{label:"Lease Rate",value:l.leaseRate,color:"text-surface-200",suffix:"/mo"},{label:"Maintenance",value:l.maintenanceMonthly,color:"text-surface-200",suffix:"/mo"},{label:"Total Monthly",value:l.totalMonthly,color:"text-brand-400",suffix:"/mo",highlight:!0},{label:"Cost/Hour",value:l.costPerHour,color:"text-surface-200"}];return e.jsxs("div",{className:"mt-6 p-4 rounded-xl bg-surface-800/50 border border-surface-700/50",children:[e.jsx("h4",{className:"text-xs font-bold text-surface-500 uppercase mb-3",children:"Live Pricing Preview"}),e.jsx("div",{className:"space-y-2",children:i.map(n=>e.jsxs("div",{className:`flex items-center justify-between ${n.highlight?"pt-2 border-t border-surface-700/50":""}`,children:[e.jsx("span",{className:`text-sm ${n.highlight?"font-semibold text-surface-200":"text-surface-400"}`,children:n.label}),e.jsx($,{mode:"wait",children:e.jsx(S.span,{initial:{opacity:0,y:-4},animate:{opacity:1,y:0},exit:{opacity:0,y:4},transition:{duration:.15},className:`text-sm font-mono font-semibold ${n.color}`,children:n.isPercent?`${n.value.toFixed(1)}%`:`${P(n.value,!1)}${n.suffix||""}`},Math.round(n.value*100))})]},n.label))})]})}const Ns=[36,48,60,72,84];function ys({slotIndex:t}){const s=f(a=>a.slots[t]),l=f(a=>a.setCommercialField),i=f(a=>a.updateSlot),n=(a,o,p=1,g=0)=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-surface-400 mb-1",children:o}),e.jsx("input",{type:"number",step:p,min:g,value:s[a]||"",onChange:r=>l(t,a,parseFloat(r.target.value)||0),placeholder:"0",className:"input w-full text-sm"})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-bold text-surface-500 uppercase mb-3",children:"Pricing"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-surface-400 mb-1",children:"Discount %"}),e.jsx("input",{type:"number",step:.5,min:0,max:100,value:s.discountPct||"",onChange:a=>i(t,{discountPct:Math.max(0,Math.min(100,parseFloat(a.target.value)||0))}),placeholder:"0",className:"input w-full text-sm"})]}),n("markupPct","Markup %",.5),n("financeCostPct","Finance Cost % (Annual)",.25)]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-bold text-surface-500 uppercase mb-3",children:"Term & Hours"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-surface-400 mb-1",children:"Operating Hours/Month"}),e.jsx("input",{type:"number",min:0,max:720,value:s.operatingHoursPerMonth||"",onChange:a=>i(t,{operatingHoursPerMonth:parseInt(a.target.value)||0}),placeholder:"180",className:"input w-full text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-surface-400 mb-1",children:"Lease Term"}),e.jsx("select",{value:s.leaseTermMonths,onChange:a=>i(t,{leaseTermMonths:parseInt(a.target.value)}),className:"input w-full text-sm",children:Ns.map(a=>e.jsxs("option",{value:a,children:[a," months"]},a))})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-bold text-surface-500 uppercase mb-3",children:"Residual Values"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[n("residualValueTruckPct","Truck %"),n("residualValueBatteryPct","Battery %"),n("residualValueAttachmentPct","Attachment %")]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-bold text-surface-500 uppercase mb-3",children:"Maintenance Rates (R/hr)"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[n("maintenanceRateTruckPerHr","Truck"),n("maintenanceRateTiresPerHr","Tires"),n("maintenanceRateAttachmentPerHr","Attachment")]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-bold text-surface-500 uppercase mb-3",children:"Telematics Subscription"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n("telematicsSubscriptionCostPerMonth","Cost/Month (R)",10),n("telematicsSubscriptionSellingPerMonth","Selling/Month (R)",10)]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-bold text-surface-500 uppercase mb-3",children:"Operator"}),n("operatorPricePerMonth","Operator Price/Month (R)",100)]}),e.jsx(bs,{slotIndex:t})]})}function Cs(){const t=f(a=>a.slots),{setCanProceed:s,activeUnitTab:l}=M(),i=t.filter(a=>!a.isEmpty&&a.modelCode!=="0");if(h.useEffect(()=>{s(!0)},[s]),i.length===0)return e.jsx("div",{className:"glass rounded-xl p-6",children:e.jsx(A,{step:5,title:"Commercial",subtitle:"No units to configure."})});const n=i[Math.min(l,i.length-1)];return e.jsxs("div",{className:"glass rounded-xl p-6",children:[e.jsx(A,{step:5,title:"Commercial",subtitle:"Set markup, residual values, maintenance rates, and lease terms for each unit."}),e.jsx(Y,{}),e.jsx(ys,{slotIndex:n.slotIndex})]})}function z({title:t,children:s,onEdit:l,editLabel:i}){return e.jsxs(S.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"glass rounded-xl p-5 border border-surface-700/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-surface-200",children:t}),l&&e.jsxs("button",{onClick:l,className:"flex items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition-colors",children:[e.jsx(fe,{className:"w-3 h-3"}),i||"Edit"]})]}),s]})}function Ss(){const t=f(u=>u),s=f(u=>u.getQuoteTotals),l=f(u=>u.getSlotPricing),i=f(u=>u.getActiveSlots),{setCanProceed:n,goToStep:a}=M(),o=s(),p=i(),g=h.useMemo(()=>De(t,o.irr,o.totalContractValue),[t,o]),r=g.some(u=>u.severity==="error");return h.useEffect(()=>{n(!r)},[r,n]),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"glass rounded-xl p-6",children:e.jsx(A,{step:6,title:"Review & Summary",subtitle:"Review your complete quote before exporting."})}),g.length>0&&e.jsx("div",{className:"space-y-2",children:g.map((u,d)=>e.jsxs("div",{className:`flex items-start gap-2 p-3 rounded-lg text-sm ${u.severity==="error"?"bg-danger/10 border border-danger/30 text-red-300":"bg-warning/10 border border-warning/30 text-yellow-300"}`,children:[e.jsx(Z,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:u.message})]},d))}),e.jsx(z,{title:"Client Information",onEdit:()=>a(0),children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Client:"}),e.jsx("div",{className:"text-surface-200 font-medium",children:t.clientName||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Contact:"}),e.jsx("div",{className:"text-surface-200",children:t.contactName||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Email:"}),e.jsx("div",{className:"text-surface-200",children:t.contactEmail||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Phone:"}),e.jsx("div",{className:"text-surface-200",children:t.contactPhone||"—"})]})]})}),e.jsx(z,{title:"Quote Settings",onEdit:()=>a(1),children:e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Factory ROE:"}),e.jsx("div",{className:"text-surface-200 font-mono",children:t.factoryROE.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Customer ROE:"}),e.jsx("div",{className:"text-surface-200 font-mono",children:t.customerROE.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Interest Rate:"}),e.jsxs("div",{className:"text-surface-200",children:[t.annualInterestRate,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Default Term:"}),e.jsxs("div",{className:"text-surface-200",children:[t.defaultLeaseTermMonths," months"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Quote Type:"}),e.jsx("div",{className:"text-surface-200 capitalize",children:t.quoteType})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Discount:"}),e.jsxs("div",{className:"text-surface-200",children:[t.discountPct,"%"]})]})]})}),p.map(u=>{const d=l(u.slotIndex);return e.jsx(z,{title:`Unit ${u.slotIndex+1}: ${u.modelName}`,onEdit:()=>a(2),children:d&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Quantity:"}),e.jsx("div",{className:"text-surface-200",children:u.quantity})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Factory Cost:"}),e.jsx("div",{className:"text-surface-200 font-mono",children:P(d.factoryCostZAR,!1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Landed Cost:"}),e.jsx("div",{className:"text-surface-200 font-mono",children:P(d.landedCostZAR,!1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Selling Price:"}),e.jsx("div",{className:"text-brand-400 font-mono font-semibold",children:P(d.sellingPriceZAR,!1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Margin:"}),e.jsx("div",{className:`font-semibold ${d.margin>=25?"text-green-400":d.margin>=15?"text-yellow-400":"text-red-400"}`,children:se(d.margin)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Lease Rate:"}),e.jsxs("div",{className:"text-surface-200 font-mono",children:[P(d.leaseRate,!1),"/mo"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Total Monthly:"}),e.jsxs("div",{className:"text-brand-400 font-mono font-semibold",children:[P(d.totalMonthly,!1),"/mo"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Contract Value:"}),e.jsx("div",{className:"text-surface-200 font-mono",children:P(d.totalContractValue,!1)})]})]})},u.slotIndex)}),e.jsx(z,{title:"Financial Analysis",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Total Selling:"}),e.jsx("div",{className:"text-surface-100 font-mono font-semibold text-lg",children:P(o.totalSalesPrice,!1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Total Monthly:"}),e.jsx("div",{className:"text-brand-400 font-mono font-semibold text-lg",children:P(o.totalMonthly,!1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Contract Value:"}),e.jsx("div",{className:"text-surface-100 font-mono font-semibold text-lg",children:P(o.totalContractValue,!1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Avg Margin:"}),e.jsx("div",{className:`font-semibold text-lg ${o.averageMargin>=25?"text-green-400":o.averageMargin>=15?"text-yellow-400":"text-red-400"}`,children:se(o.averageMargin)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"IRR:"}),e.jsx("div",{className:"text-surface-200 font-mono",children:o.irr!==null?`${(o.irr*100).toFixed(2)}%`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"NPV:"}),e.jsx("div",{className:"text-surface-200 font-mono",children:P(o.npv,!1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Commission:"}),e.jsx("div",{className:"text-surface-200 font-mono",children:P(o.commission,!1)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-surface-500",children:"Units:"}),e.jsx("div",{className:"text-surface-200",children:o.unitCount})]})]})}),!r&&p.length>0&&e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-green-500/10 border border-green-500/30 text-green-300 text-sm",children:[e.jsx(G,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:"Quote looks good! Proceed to export."})]})]})}function ws(){const t=f(v=>v),s=f(v=>v.getQuoteTotals),l=f(v=>v.getSlotPricing),i=f(v=>v.submitForApproval),{saveNow:n}=Be(),a=ye(),{user:o}=Ue(),{setCanProceed:p}=M(),[g,r]=h.useState(!1),[u,d]=h.useState(!1),[j,N]=h.useState(!1),[c,C]=h.useState(!1);h.useEffect(()=>{p(!0)},[p]);const k=async()=>{d(!0);try{await n(),C(!0),Q.success("Quote saved successfully")}catch{Q.error("Failed to save quote")}finally{d(!1)}},T=async()=>{r(!0);try{const v=s(),y=new Map;t.slots.forEach(O=>{if(!O.isEmpty&&O.modelCode!=="0"){const U=l(O.slotIndex);U&&y.set(O.slotIndex,U)}});const D=await $e(t,v,y);D.success?(N(!0),Q.success("PDF exported successfully",{description:D.filename})):Q.error("PDF export failed",{description:D.error})}catch(v){Q.error("Failed to export PDF",{description:v instanceof Error?v.message:"Unknown error"})}finally{r(!1)}},E=()=>{o&&(i(o.id||o.username),Q.success("Quote submitted for approval"))};return e.jsxs("div",{className:"glass rounded-xl p-6",children:[e.jsx(A,{step:7,title:"Export & Save",subtitle:"Save your quote, generate a PDF, or submit for approval."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"glass rounded-xl p-5 border border-surface-700/30",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand-500/10 flex items-center justify-center",children:e.jsx(te,{className:"w-5 h-5 text-brand-500"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-surface-200",children:"Save Quote"}),e.jsx("div",{className:"text-xs text-surface-400",children:"Save to local database"})]})]}),e.jsx(B,{variant:"secondary",icon:c?G:te,onClick:k,loading:u,className:"w-full",children:c?"Saved!":"Save Quote"})]}),e.jsxs("div",{className:"glass rounded-xl p-5 border border-surface-700/30",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-feature-500/10 flex items-center justify-center",children:e.jsx(ae,{className:"w-5 h-5 text-feature-500"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-surface-200",children:"Export PDF"}),e.jsx("div",{className:"text-xs text-surface-400",children:"Generate and download quote PDF"})]})]}),e.jsx(B,{variant:"primary",icon:j?G:ae,onClick:T,loading:g,className:"w-full",children:g?"Generating...":j?"Exported!":"Generate PDF"})]}),e.jsxs("div",{className:"glass rounded-xl p-5 border border-surface-700/30",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-warning/10 flex items-center justify-center",children:e.jsx(ne,{className:"w-5 h-5 text-warning"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-surface-200",children:"Submit for Approval"}),e.jsx("div",{className:"text-xs text-surface-400",children:"Send to manager for review"})]})]}),e.jsx(B,{variant:"secondary",icon:ne,onClick:E,disabled:t.approvalStatus==="pending-approval",className:"w-full",children:t.approvalStatus==="pending-approval"?"Pending Approval":"Submit"})]}),e.jsxs("div",{className:"glass rounded-xl p-5 border border-surface-700/30",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-surface-700/50 flex items-center justify-center",children:e.jsx(re,{className:"w-5 h-5 text-surface-300"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-surface-200",children:"Back to Dashboard"}),e.jsx("div",{className:"text-xs text-surface-400",children:"View in full dashboard layout"})]})]}),e.jsx(B,{variant:"ghost",icon:re,onClick:()=>a("/"),className:"w-full",children:"Open Dashboard"})]})]})]})}const Ps=[ns,is,us,gs,vs,Cs,Ss,ws];function ks(){const{currentStep:t}=M(),s=Ps[t];return e.jsx(Ge,{children:e.jsx(Ye,{stepKey:t,children:e.jsx(s,{})})})}function Bs(){return e.jsx(Ze,{children:e.jsx(ks,{})})}export{Bs as default};
